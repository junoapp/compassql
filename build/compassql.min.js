!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).cql=t()}(this,(function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}function r(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function e(){var t=isNaN(arguments[0])?1:Number(arguments[0]);return t?Array.prototype.reduce.call(this,(function(n,r){return Array.isArray(r)?n.push.apply(n,e.call(r,t-1)):n.push(r),n}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(e){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var i=n((function(e){var t=function(){function e(e,t){return null!=t&&e instanceof t}var t,n,r;try{t=Map}catch(e){t=function(){}}try{n=Set}catch(e){n=function(){}}try{r=Promise}catch(e){r=function(){}}function i(o,s,c,u,l){"object"==typeof s&&(c=s.depth,u=s.prototype,l=s.includeNonEnumerable,s=s.circular);var d=[],f=[],p="undefined"!=typeof Buffer;return void 0===s&&(s=!0),void 0===c&&(c=1/0),function o(c,g){if(null===c)return null;if(0===g)return c;var y,h;if("object"!=typeof c)return c;if(e(c,t))y=new t;else if(e(c,n))y=new n;else if(e(c,r))y=new r((function(e,t){c.then((function(t){e(o(t,g-1))}),(function(e){t(o(e,g-1))}))}));else if(i.__isArray(c))y=[];else if(i.__isRegExp(c))y=new RegExp(c.source,a(c)),c.lastIndex&&(y.lastIndex=c.lastIndex);else if(i.__isDate(c))y=new Date(c.getTime());else{if(p&&Buffer.isBuffer(c))return y=Buffer.allocUnsafe?Buffer.allocUnsafe(c.length):new Buffer(c.length),c.copy(y),y;e(c,Error)?y=Object.create(c):void 0===u?(h=Object.getPrototypeOf(c),y=Object.create(h)):(y=Object.create(u),h=u)}if(s){var m=d.indexOf(c);if(-1!=m)return f[m];d.push(c),f.push(y)}for(var E in e(c,t)&&c.forEach((function(e,t){var n=o(t,g-1),r=o(e,g-1);y.set(n,r)})),e(c,n)&&c.forEach((function(e){var t=o(e,g-1);y.add(t)})),c){var O;h&&(O=Object.getOwnPropertyDescriptor(h,E)),O&&null==O.set||(y[E]=o(c[E],g-1))}if(Object.getOwnPropertySymbols){var T=Object.getOwnPropertySymbols(c);for(E=0;E<T.length;E++){var v=T[E];(!(P=Object.getOwnPropertyDescriptor(c,v))||P.enumerable||l)&&(y[v]=o(c[v],g-1),P.enumerable||Object.defineProperty(y,v,{enumerable:!1}))}}if(l){var b=Object.getOwnPropertyNames(c);for(E=0;E<b.length;E++){var P,_=b[E];(P=Object.getOwnPropertyDescriptor(c,_))&&P.enumerable||(y[_]=o(c[_],g-1),Object.defineProperty(y,_,{enumerable:!1}))}}return y}(o,c)}function o(e){return Object.prototype.toString.call(e)}function a(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return i.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},i.__objToStr=o,i.__isDate=function(e){return"object"==typeof e&&"[object Date]"===o(e)},i.__isArray=function(e){return"object"==typeof e&&"[object Array]"===o(e)},i.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===o(e)},i.__getRegExpFlags=a,i}();e.exports&&(e.exports=t)})),o=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n,r="boolean"==typeof t.cycles&&t.cycles,i=t.cmp&&(n=t.cmp,function(e){return function(t,r){var i={key:t,value:e[t]},o={key:r,value:e[r]};return n(i,o)}}),o=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var n,a;if(Array.isArray(t)){for(a="[",n=0;n<t.length;n++)n&&(a+=","),a+=e(t[n])||"null";return a+"]"}if(null===t)return"null";if(-1!==o.indexOf(t)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var s=o.push(t)-1,c=Object.keys(t).sort(i&&i(t));for(a="",n=0;n<c.length;n++){var u=c[n],l=e(t[u]);l&&(a&&(a+=","),a+=JSON.stringify(u)+":"+l)}return o.splice(s,1),"{"+a+"}"}}(e)};function a(e,t,n){return e.fields=t||[],e.fname=n,e}function s(e){return 1===e.length?c(e[0]):u(e)}const c=e=>function(t){return t[e]},u=e=>{const t=e.length;return function(n){for(let r=0;r<t;++r)n=n[e[r]];return n}};function l(e){throw Error(e)}function d(e){const t=[],n=e.length;let r,i,o,a=null,s=0,c="";function u(){t.push(c+e.substring(r,i)),c="",r=i+1}for(e+="",r=i=0;i<n;++i)if(o=e[i],"\\"===o)c+=e.substring(r,i),c+=e.substring(++i,++i),r=i;else if(o===a)u(),a=null,s=-1;else{if(a)continue;r===s&&'"'===o||r===s&&"'"===o?(r=i+1,a=o):"."!==o||s?"["===o?(i>r&&u(),s=r=i+1):"]"===o&&(s||l("Access path missing open bracket: "+e),s>0&&u(),s=0,r=i+1):i>r?u():r=i+1}return s&&l("Access path missing closing bracket: "+e),a&&l("Access path missing closing quote: "+e),i>r&&(i++,u()),t}(function(e,t,n){const r=d(e);e=1===r.length?r[0]:e,a((n&&n.get||s)(r),[e],t||e)})("id"),a((e=>e),[],"identity");const f=a((()=>0),[],"zero"),p=a((()=>1),[],"one");a((()=>!0),[],"true"),a((()=>!1),[],"false");function g(e,t,n){const r=[t].concat([].slice.call(n));console[e].apply(console,r)}var y=Array.isArray;function h(e){return e===Object(e)}function m(e){return e[e.length-1]}function E(e){return null!=e?y(e)?e:[e]:[]}const O=Object.prototype.hasOwnProperty;function T(e){return"boolean"==typeof e}function v(e){return"number"==typeof e}function b(e){return"string"==typeof e}function P(e){return y(e)?"["+e.map(P)+"]":h(e)||b(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e}function _(e){const t={},n=e.length;for(let r=0;r<n;++r)t[e[r]]=!0;return t}const S=i;Set.prototype.toJSON=function(){return`Set(${[...this].map((e=>o(e))).join(",")})`};const A=o;function N(e,t){return e.indexOf(t)>-1}function C(e,t){let n=0;for(const[r,i]of e.entries())if(t(i,r,n++))return!0;return!1}const I=Object.keys,D=Object.entries;function M(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function R(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function w(...e){for(const t of e)if(void 0!==t)return t}function U(e){return!!v(e)||!isNaN(e)&&!isNaN(parseFloat(e))}var F=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const x="row",L="column",k="facet",j="x",B="y",W="x2",Y="y2",G="radius",Q="radius2",$="theta",H="theta2",q="latitude",z="longitude",V="latitude2",K="longitude2",X="color",J="fill",Z="stroke",ee="shape",te="size",ne="angle",re="opacity",ie="fillOpacity",oe="strokeOpacity",ae="strokeWidth",se="strokeDash",ce="text",ue="order",le="detail",de="key",fe="tooltip",pe="href",ge="url",ye="description",he={theta:1,theta2:1,radius:1,radius2:1};function me(e){return e in he}const Ee={longitude:1,longitude2:1,latitude:1,latitude2:1};const Oe=I(Ee),Te=Object.assign(Object.assign(Object.assign(Object.assign({},{x:1,y:1,x2:1,y2:1}),he),Ee),{color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function ve(e){return e===X||e===J||e===Z}const be={row:1,column:1,facet:1},Pe=I(be),_e=Object.assign(Object.assign({},Te),be),Se=I(_e),Ae=F(_e,["order","detail","tooltip"]),Ne=F(Ae,["row","column","facet"]),Ce=I(Ae),Ie=I(Ne);const De=[W,Y,V,K,H,Q];function Me(e){return Re(e)!==e}function Re(e){switch(e){case W:return j;case Y:return B;case V:return q;case K:return z;case H:return $;case Q:return G}return e}function we(e){switch(e){case j:return W;case B:return Y;case q:return V;case z:return K;case $:return H;case G:return Q}}const Ue=I(Te),Fe=F(Te,["x","y","x2","y2","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]),xe=I(Fe),Le={x:1,y:1},ke=I(Le);function je(e){return e in Le}const Be={theta:1,radius:1},We=I(Be);const Ye=F(Fe,["text","tooltip","href","url","description","detail","key","order"]),Ge=I(Ye);const Qe=Object.assign(Object.assign(Object.assign({},Le),Be),Ye),$e=I(Qe);function He(e){return!!Qe[e]}const qe={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},ze=F(qe,["geoshape"]);function Ve(e){switch(e){case j:case B:case $:case G:case te:case ne:case ae:case re:case ie:case oe:case W:case Y:case H:case Q:return;case k:case x:case L:case ee:case se:case ce:case fe:case pe:case ge:case ye:return"discrete";case X:case J:case Z:return"flexible";case q:case z:case V:case K:case le:case de:case ue:return}}var Ke=Object.freeze({__proto__:null,ROW:x,COLUMN:L,FACET:k,X:j,Y:B,X2:W,Y2:Y,RADIUS:G,RADIUS2:Q,THETA:$,THETA2:H,LATITUDE:q,LONGITUDE:z,LATITUDE2:V,LONGITUDE2:K,COLOR:X,FILL:J,STROKE:Z,SHAPE:ee,SIZE:te,ANGLE:ne,OPACITY:re,FILLOPACITY:ie,STROKEOPACITY:oe,STROKEWIDTH:ae,STROKEDASH:se,TEXT:ce,ORDER:ue,DETAIL:le,KEY:de,TOOLTIP:fe,HREF:pe,URL:ge,DESCRIPTION:ye,isPolarPositionChannel:me,getPositionChannelFromLatLong:function(e){switch(e){case q:return"y";case V:return"y2";case z:return"x";case K:return"x2"}},isGeoPositionChannel:function(e){return e in Ee},GEOPOSITION_CHANNELS:Oe,isColorChannel:ve,FACET_CHANNELS:Pe,CHANNELS:Se,SINGLE_DEF_CHANNELS:Ce,SINGLE_DEF_UNIT_CHANNELS:Ie,isSingleDefUnitChannel:function(e){return!!Ne[e]},isChannel:function(e){return!!_e[e]},SECONDARY_RANGE_CHANNEL:De,isSecondaryRangeChannel:Me,getMainRangeChannel:Re,getVgPositionChannel:function(e){if(me(e))switch(e){case $:return"startAngle";case H:return"endAngle";case G:return"outerRadius";case Q:return"innerRadius"}return e},getSecondaryRangeChannel:we,getSizeChannel:function(e){switch(e){case j:case W:return"width";case B:case Y:return"height"}},getOffsetChannel:function(e){switch(e){case j:return"xOffset";case B:return"yOffset";case W:return"x2Offset";case Y:return"y2Offset";case $:return"thetaOffset";case G:return"radiusOffset";case H:return"theta2Offset";case Q:return"radius2Offset"}},UNIT_CHANNELS:Ue,NONPOSITION_CHANNELS:xe,POSITION_SCALE_CHANNEL_INDEX:Le,POSITION_SCALE_CHANNELS:ke,isXorY:je,POLAR_POSITION_SCALE_CHANNEL_INDEX:Be,POLAR_POSITION_SCALE_CHANNELS:We,getPositionScaleChannel:function(e){return"width"===e?j:B},NONPOSITION_SCALE_CHANNELS:Ge,isNonPositionScaleChannel:function(e){return!!Fe[e]},supportLegend:function(e){switch(e){case X:case J:case Z:case te:case ee:case re:case ae:case se:return!0;case ie:case oe:case ne:return!1}},SCALE_CHANNELS:$e,isScaleChannel:He,supportMark:function(e,t){return function(e){switch(e){case X:case J:case Z:case ye:case le:case de:case fe:case pe:case ue:case re:case ie:case oe:case ae:case k:case x:case L:return qe;case j:case B:case q:case z:return ze;case W:case Y:case V:case K:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case te:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case se:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case ee:return{point:"always",geoshape:"always"};case ce:return{text:"always"};case ne:return{point:"always",square:"always",text:"always"};case ge:return{image:"always"};case $:case G:return{text:"always",arc:"always"};case H:case Q:return{arc:"always"}}}(e)[t]},rangeType:Ve});const Xe={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},Je=Object.assign(Object.assign({},Xe),{style:1,labelExpr:1,encoding:1});const Ze=I(Je),et=I({axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1});var tt=Object.freeze({__proto__:null,CONDITIONAL_AXIS_PROP_INDEX:{labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}},isConditionalAxisValue:function(e){return e&&e.condition},AXIS_PARTS:["domain","grid","labels","ticks","title"],AXIS_PROPERTY_TYPE:{grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"main",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},COMMON_AXIS_PROPERTIES_INDEX:Xe,isAxisProperty:function(e){return!!Je[e]},AXIS_PROPERTIES:Ze,AXIS_CONFIGS:et});const nt={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},rt=I(nt);var it=Object.freeze({__proto__:null,LEGEND_SCALE_CHANNELS:["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],defaultLegendConfig:{gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},COMMON_LEGEND_PROPERTY_INDEX:nt,LEGEND_PROPERTIES:rt});function ot(e){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${e} are dropped.`}function at(e){return`Invalid field type "${e}".`}function st(e){return e+" encoding should be discrete (ordinal / nominal / binned)."}function ct(e,t){return`Using discrete channel "${e}" to encode "${t}" field can be misleading as it does not encode ${"ordinal"===t?"order":"magnitude"}.`}function ut(e,t){return`Invalid ${e}: ${A(t)}.`}let lt=function(e,t){let n=e||0;return{level(e){return arguments.length?(n=+e,this):n},error(){return n>=1&&g(t||"error","ERROR",arguments),this},warn(){return n>=2&&g(t||"warn","WARN",arguments),this},info(){return n>=3&&g(t||"log","INFO",arguments),this},debug(){return n>=4&&g(t||"log","DEBUG",arguments),this}}}(2);function dt(...e){lt.warn(...e)}const ft={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"};const pt=ft.quantitative,gt=ft.ordinal,yt=ft.temporal,ht=ft.nominal,mt=ft.geojson,Et=I(ft);function Ot(e){if(e)switch(e=e.toLowerCase()){case"q":case pt:return"quantitative";case"t":case yt:return"temporal";case"o":case gt:return"ordinal";case"n":case ht:return"nominal";case mt:return"geojson"}}var Tt=Object.freeze({__proto__:null,Type:ft,isType:function(e){return e in ft},QUANTITATIVE:pt,ORDINAL:gt,TEMPORAL:yt,NOMINAL:ht,GEOJSON:mt,TYPES:Et,getFullName:Ot}),vt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const bt={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},Pt={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"},_t=I(Pt);const St={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};const At=["linear","log","pow","sqrt","symlog","time","utc"],Nt=_(At),Ct=["linear","log","pow","sqrt","symlog"],It=_(Ct);const Dt=["quantile","quantize","threshold"],Mt=_(Dt),Rt=At.concat(["quantile","quantize","threshold","sequential","identity"]),wt=_(Rt),Ut=["ordinal","bin-ordinal","point","band"],Ft=_(Ut);function xt(e){return e in Ft}function Lt(e){return e in wt}function kt(e){return e in Nt}function jt(e){return e in Mt}const Bt={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},Wt=I(Bt),Yt=vt(Bt,["type","domain","range","rangeMax","rangeMin","scheme"]),Gt=I(Yt);function Qt(e,t){return N([gt,ht],t)?void 0===e||xt(e):t===yt?N([bt.TIME,bt.UTC,void 0],e):t!==pt||N([bt.LOG,bt.POW,bt.SQRT,bt.SYMLOG,bt.QUANTILE,bt.QUANTIZE,bt.THRESHOLD,bt.LINEAR,void 0],e)}function $t(e,t){if(!He(e))return!1;switch(e){case j:case B:case $:case G:return kt(t)||N(["band","point"],t);case te:case ae:case re:case ie:case oe:case ne:return kt(t)||jt(t)||N(["band","point","ordinal"],t);case X:case J:case Z:return"band"!==t;case se:return"ordinal"===t||jt(t);case ee:return"ordinal"===t}}var Ht=Object.freeze({__proto__:null,ScaleType:bt,SCALE_CATEGORY_INDEX:Pt,SCALE_TYPES:_t,scaleCompatible:function(e,t){const n=Pt[e],r=Pt[t];return n===r||"ordinal-position"===n&&"time"===r||"ordinal-position"===r&&"time"===n},scaleTypePrecedence:function(e){return St[e]},CONTINUOUS_TO_CONTINUOUS_SCALES:At,QUANTITATIVE_SCALES:Ct,isQuantitative:function(e){return e in It},CONTINUOUS_TO_DISCRETE_SCALES:Dt,CONTINUOUS_DOMAIN_SCALES:Rt,DISCRETE_DOMAIN_SCALES:Ut,TIME_SCALE_TYPES:["time","utc"],hasDiscreteDomain:xt,hasContinuousDomain:Lt,isContinuousToContinuous:kt,isContinuousToDiscrete:jt,defaultScaleConfig:{pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4},isExtendedScheme:function(e){return!b(e)&&!!e.name},isSelectionDomain:function(e){return null==e?void 0:e.selection},isDomainUnionWith:function(e){return e&&e.unionWith},SCALE_PROPERTIES:Wt,NON_TYPE_DOMAIN_RANGE_VEGA_SCALE_PROPERTIES:Gt,scaleTypeSupportProperty:function(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!N(["point","band","identity"],e);case"bins":return!N(["point","band","identity","ordinal"],e);case"round":return kt(e)||"band"===e||"point"===e;case"padding":case"rangeMin":case"rangeMax":return kt(e)||N(["point","band"],e);case"paddingOuter":case"align":return N(["point","band"],e);case"paddingInner":return"band"===e;case"domainMax":case"domainMid":case"domainMin":case"clamp":return kt(e);case"nice":return kt(e)||"quantize"===e||"threshold"===e;case"exponent":return"pow"===e;case"base":return"log"===e;case"constant":return"symlog"===e;case"zero":return Lt(e)&&!N(["log","time","utc","threshold","quantile"],e)}},channelScalePropertyIncompatability:function(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return ve(e)?void 0:`Cannot use the scale property "${e}" with non-color channel.`;case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}},scaleTypeSupportDataType:Qt,channelSupportScaleType:$t}),qt=n((function(e){var t=e.exports,n="__name__";t.namedfunc=function(e,t){return t[n]=e,t},t.name=function(e){return null==e?null:e[n]},t.identity=function(e){return e},t.true=t.namedfunc("true",(function(){return!0})),t.false=t.namedfunc("false",(function(){return!1})),t.duplicate=function(e){return JSON.parse(JSON.stringify(e))},t.equal=function(e,t){return JSON.stringify(e)===JSON.stringify(t)},t.extend=function(e){for(var t,n,r=1,i=arguments.length;r<i;++r)for(n in t=arguments[r])e[n]=t[n];return e},t.length=function(e){return null!=e&&null!=e.length?e.length:null},t.keys=function(e){var t,n=[];for(t in e)n.push(t);return n},t.vals=function(e){var t,n=[];for(t in e)n.push(e[t]);return n},t.toMap=function(e,n){return(n=t.$(n))?e.reduce((function(e,t){return e[n(t)]=1,e}),{}):e.reduce((function(e,t){return e[t]=1,e}),{})},t.keystr=function(e){var t=e.length;if(!t)return"";for(var n=String(e[0]),r=1;r<t;++r)n+="|"+String(e[r]);return n};var r=Object.prototype.toString;t.isObject=function(e){return e===Object(e)},t.isFunction=function(e){return"[object Function]"===r.call(e)},t.isString=function(e){return"string"==typeof value||"[object String]"===r.call(e)},t.isArray=Array.isArray||function(e){return"[object Array]"===r.call(e)},t.isNumber=function(e){return"number"==typeof e||"[object Number]"===r.call(e)},t.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==r.call(e)},t.isDate=function(e){return"[object Date]"===r.call(e)},t.isValid=function(e){return null!=e&&e==e},t.isBuffer="function"==typeof Buffer&&Buffer.isBuffer||t.false,t.number=function(e){return null==e||""===e?null:+e},t.boolean=function(e){return null==e||""===e?null:"false"!==e&&!!e},t.date=function(e,t){var n=t||Date;return null==e||""===e?null:n.parse(e)},t.array=function(e){return null!=e?t.isArray(e)?e:[e]:[]},t.str=function(e){return t.isArray(e)?"["+e.map(t.str)+"]":t.isObject(e)||t.isString(e)?JSON.stringify(e).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):e};var i=/\[(.*?)\]|[^.\[]+/g;function o(e,t){var n,r="";for(n=0;n<e;++n)r+=t;return r}function a(e,t,n){var r=0,i=e.split(s);return(e=n?(i=i.reverse()).filter((function(e){return(r+=e.length)<=t})).reverse():i.filter((function(e){return(r+=e.length)<=t}))).length?e.join("").trim():i[0].slice(0,t)}t.field=function(e){return String(e).match(i).map((function(e){return"["!==e[0]?e:"'"!==e[1]&&'"'!==e[1]?e.slice(1,-1):e.slice(2,-2).replace(/\\(["'])/g,"$1")}))},t.accessor=function(e){return null==e||t.isFunction(e)?e:t.namedfunc(e,Function("x","return x["+t.field(e).map(t.str).join("][")+"];"))},t.$=t.accessor,t.mutator=function(e){var n;return t.isString(e)&&(n=t.field(e)).length>1?function(e,t){for(var r=0;r<n.length-1;++r)e=e[n[r]];e[n[r]]=t}:function(t,n){t[e]=n}},t.$func=function(e,n){return function(r){r=t.$(r)||t.identity;var i=e+(t.name(r)?"_"+t.name(r):"");return t.namedfunc(i,(function(e){return n(r(e))}))}},t.$valid=t.$func("valid",t.isValid),t.$length=t.$func("length",t.length),t.$in=function(e,n){e=t.$(e);var r=t.isArray(n)?t.toMap(n):n;return function(t){return!!r[e(t)]}},t.comparator=function(e){var n=[];return void 0===e&&(e=[]),e=t.array(e).map((function(e){var r=1;return"-"===e[0]?(r=-1,e=e.slice(1)):"+"===e[0]&&(r=1,e=e.slice(1)),n.push(r),t.accessor(e)})),function(r,i){var o,a,s,c;for(o=0,a=e.length;o<a;++o)if(s=e[o],c=t.cmp(s(r),s(i)))return c*n[o];return 0}},t.cmp=function(e,t){return(e<t||null==e)&&null!=t?-1:(e>t||null==t)&&null!=e?1:(t=t instanceof Date?+t:t,(e=e instanceof Date?+e:e)!==e&&t==t?-1:t!=t&&e==e?1:0)},t.numcmp=function(e,t){return e-t},t.stablesort=function(e,t,n){var r=e.reduce((function(e,t,r){return e[n(t)]=r,e}),{});return e.sort((function(e,i){var o=t(e),a=t(i);return o<a?-1:o>a?1:r[n(e)]-r[n(i)]})),e},t.permute=function(e){for(var t,n,r=e.length;r;)n=Math.floor(Math.random()*r--),t=e[r],e[r]=e[n],e[n]=t},t.pad=function(e,t,n,r){r=r||" ";var i=t-e.length;if(i<=0)return e;switch(n){case"left":return o(i,r)+e;case"middle":case"center":return o(Math.floor(i/2),r)+e+o(Math.ceil(i/2),r);default:return e+o(i,r)}},t.truncate=function(e,t,n,r,i){var o=e.length;if(o<=t)return e;i=void 0!==i?String(i):"â€¦";var s=Math.max(0,t-i.length);switch(n){case"left":return i+(r?a(e,s,1):e.slice(o-s));case"middle":case"center":var c=Math.ceil(s/2),u=Math.floor(s/2);return(r?a(e,c):e.slice(0,c))+i+(r?a(e,u,1):e.slice(o-u));default:return(r?a(e,s):e.slice(0,s))+i}};var s=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/})),zt=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.flagKeys=t.without=t.nestedMap=t.some=t.forEach=t.every=t.contains=t.isArray=t.toMap=t.isBoolean=t.isObject=t.extend=t.duplicate=t.keys=t.cmp=void 0,Object.defineProperty(t,"isArray",{enumerable:!0,get:function(){return qt.isArray}});var n=qt;function r(e,t){return-1!==e.indexOf(t)}Object.defineProperty(t,"cmp",{enumerable:!0,get:function(){return n.cmp}}),Object.defineProperty(t,"keys",{enumerable:!0,get:function(){return n.keys}}),Object.defineProperty(t,"duplicate",{enumerable:!0,get:function(){return n.duplicate}}),Object.defineProperty(t,"extend",{enumerable:!0,get:function(){return n.extend}}),Object.defineProperty(t,"isObject",{enumerable:!0,get:function(){return n.isObject}}),Object.defineProperty(t,"isBoolean",{enumerable:!0,get:function(){return n.isBoolean}}),Object.defineProperty(t,"toMap",{enumerable:!0,get:function(){return n.toMap}}),t.contains=r,t.every=function(e,t){for(let n=0;n<e.length;n++)if(!t(e[n],n))return!1;return!0},t.forEach=function(e,t,n){if(e.forEach)e.forEach.call(n,t);else for(let r in e)t.call(n,e[r],r,e)},t.some=function(e,t){let n,r=0;for(n in e)if(t(e[n],n,r++))return!0;return!1},t.nestedMap=function e(t,n){return t.map((t=>qt.isArray(t)?e(t,n):n(t)))},t.without=function(e,t){return e.filter((function(e){return!r(t,e)}))},t.flagKeys=function(e){return Object.keys(e)}})),Vt=r(tt),Kt=r(it),Xt=r(Ht),Jt=n((function(e,t){function n(e){return!!e.parent}Object.defineProperty(t,"__esModule",{value:!0}),t.Property=t.DEFAULT_PROP_PRECEDENCE=t.ALL_ENCODING_PROPS=t.isEncodingProperty=t.getEncodingNestedProp=t.fromKey=t.toKey=t.VIEW_PROPS=t.ENCODING_NESTED_PROPS=t.SCALE_PROPS=t.SORT_PROPS=t.SORT_CHILD_PROPS=t.BIN_CHILD_PROPS=t.isEncodingNestedParent=t.isEncodingTopLevelProperty=t.ENCODING_TOPLEVEL_PROPS=t.isEncodingNestedProp=void 0,t.isEncodingNestedProp=n;const r={channel:1,aggregate:1,autoCount:1,bin:1,timeUnit:1,hasFn:1,sort:1,stack:1,field:1,type:1,format:1,scale:1,axis:1,legend:1,value:1};function i(e){return e.toString()in r}t.ENCODING_TOPLEVEL_PROPS=zt.flagKeys(r),t.isEncodingTopLevelProperty=i;const o={bin:1,scale:1,sort:1,axis:1,legend:1};t.isEncodingNestedParent=function(e){return o[e]},t.BIN_CHILD_PROPS=["maxbins","divide","extent","base","step","steps","minstep"],t.SORT_CHILD_PROPS=["field","op","order"];const a=t.BIN_CHILD_PROPS.map((e=>({parent:"bin",child:e})));t.SORT_PROPS=t.SORT_CHILD_PROPS.map((e=>({parent:"sort",child:e}))),t.SCALE_PROPS=Xt.SCALE_PROPERTIES.map((e=>({parent:"scale",child:e})));const s=Vt.AXIS_PROPERTIES.map((e=>({parent:"axis",child:e}))),c=Kt.LEGEND_PROPERTIES.map((e=>({parent:"legend",child:e})));t.ENCODING_NESTED_PROPS=[].concat(a,t.SORT_PROPS,t.SCALE_PROPS,s,c),t.VIEW_PROPS=["width","height","background","padding","title"];t.toKey=function(e){return n(e)?e.parent+"."+e.child:e},t.fromKey=function(e){const t=e.split(".");if(1===t.length)return e;if(2===t.length)return{parent:t[0],child:t[1]};throw`Invalid property key with ${t.length} dots: ${e}`};const u=t.ENCODING_NESTED_PROPS.reduce(((e,t)=>(e[t.parent]=e[t.parent]||[],e[t.parent][t.child]=t,e)),{});t.getEncodingNestedProp=function(e,t){return(u[e]||{})[t]},t.isEncodingProperty=function(e){return i(e)||n(e)},t.ALL_ENCODING_PROPS=[].concat(t.ENCODING_TOPLEVEL_PROPS,t.ENCODING_NESTED_PROPS),t.DEFAULT_PROP_PRECEDENCE=["type","field","bin","timeUnit","aggregate","autoCount","channel","mark","stack","scale","sort","axis","legend"].concat(a,t.SCALE_PROPS,s,c,t.SORT_PROPS),function(e){e.MARK="mark",e.TRANSFORM="transform",e.STACK="stack",e.FORMAT="format",e.CHANNEL="channel",e.AGGREGATE="aggregate",e.AUTOCOUNT="autoCount",e.BIN="bin",e.HAS_FN="hasFn",e.TIMEUNIT="timeUnit",e.FIELD="field",e.TYPE="type",e.SORT="sort",e.SCALE="scale",e.AXIS="axis",e.LEGEND="legend",e.WIDTH="width",e.HEIGHT="height",e.BACKGROUND="background",e.PADDING="padding",e.TITLE="title"}(t.Property||(t.Property={}))}));const Zt={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},en=Zt.arc,tn=Zt.area,nn=Zt.bar,rn=Zt.image,on=Zt.line,an=Zt.point,sn=Zt.rect,cn=Zt.rule,un=Zt.text,ln=Zt.tick,dn=Zt.trail,fn=Zt.circle,pn=Zt.square,gn=Zt.geoshape;function yn(e){return N(["line","area","trail"],e)}function hn(e){return N(["rect","bar","image","arc"],e)}const mn=I(Zt);function En(e){return e.type}const On=_(mn);const Tn=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],vn=["fill","fillOpacity"],bn=[...Tn,...vn],Pn=I({color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBand:1,timeUnitBandPosition:1}),_n=I({mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1}),Sn={binSpacing:1,continuousBandSize:5,timeUnitBandPosition:.5},An={binSpacing:0,continuousBandSize:5,timeUnitBandPosition:.5};var Nn=Object.freeze({__proto__:null,Mark:Zt,ARC:en,AREA:tn,BAR:nn,IMAGE:rn,LINE:on,POINT:an,RECT:sn,RULE:cn,TEXT:un,TICK:ln,TRAIL:dn,CIRCLE:fn,SQUARE:pn,GEOSHAPE:gn,isMark:function(e){return e in Zt},isPathMark:yn,isRectBasedMark:hn,PRIMITIVE_MARKS:mn,isMarkDef:En,isPrimitiveMark:function(e){return(En(e)?e.type:e)in On},STROKE_CONFIG:Tn,FILL_CONFIG:vn,FILL_STROKE_CONFIG:bn,VL_ONLY_MARK_CONFIG_PROPERTIES:Pn,VL_ONLY_MARK_SPECIFIC_CONFIG_PROPERTY_INDEX:{area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]},defaultMarkConfig:{color:"#4c78a8",invalid:"filter",timeUnitBand:1},MARK_CONFIGS:_n,BAR_CORNER_RADIUS_INDEX:{horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},defaultBarConfig:Sn,defaultRectConfig:An,defaultTickConfig:{thickness:1},getMarkType:function(e){return En(e)?e.type:e}}),Cn=r(Ke),In=r(Nn),Dn=r(Tt),Mn=n((function(t,n){var r=e&&e.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.getDefaultEnumValues=n.DEFAULT_ENUM_INDEX=n.getDefaultName=n.DEFAULT_NAME=n.initWildcard=n.isWildcardDef=n.isShortWildcard=n.isWildcard=n.SHORT_WILDCARD=void 0;const a=o(In),s=o(Dn);function c(e){return e===n.SHORT_WILDCARD}function u(e){return!(void 0===e||null==e||!e.enum&&!e.name||zt.isArray(e))}function l(e){let t={},n={};for(const r of e){const e=[0];for(let t=0;t<r.length;t++)r.charAt(t).toUpperCase()===r.charAt(t)&&e.push(t);let i=e.map((e=>r.charAt(e))).join("").toLowerCase();if(n[i])if(e[e.length-1]===r.length-1||(i=e.concat([r.length-1]).map((e=>r.charAt(e))).join("").toLowerCase(),n[i]))for(let e=1;!t[r];e++){let o=`${i}_${e}`;if(!n[o]){t[r]=o,n[o]=!0;break}}else t[r]=i,n[i]=!0;else t[r]=i,n[i]=!0}return t}n.SHORT_WILDCARD="?",n.isWildcard=function(e){return c(e)||u(e)},n.isShortWildcard=c,n.isWildcardDef=u,n.initWildcard=function(e,t,r){return zt.extend({},{name:t,enum:r},e===n.SHORT_WILDCARD?{}:e)},n.DEFAULT_NAME={mark:"m",channel:"c",aggregate:"a",autoCount:"#",hasFn:"h",bin:"b",sort:"so",stack:"st",scale:"s",format:"f",axis:"ax",legend:"l",value:"v",timeUnit:"tu",field:"f",type:"t",binProps:{maxbins:"mb",min:"mi",max:"ma",base:"b",step:"s",steps:"ss",minstep:"ms",divide:"d"},sortProps:{field:"f",op:"o",order:"or"},scaleProps:l(Xt.SCALE_PROPERTIES),axisProps:l(Vt.AXIS_PROPERTIES),legendProps:l(Kt.LEGEND_PROPERTIES)},n.getDefaultName=function(e){if(Jt.isEncodingNestedProp(e))return`${n.DEFAULT_NAME[e.parent]}-${n.DEFAULT_NAME[e.parent+"Props"][e.child]}`;if(n.DEFAULT_NAME[e])return n.DEFAULT_NAME[e];throw new Error("Default name undefined for "+e)};const d=[!1,!0],f={maxbins:[5,10,20],extent:[void 0],base:[10],step:[void 0],steps:[void 0],minstep:[void 0],divide:[[5,2]],binned:[!1],anchor:[void 0],nice:[!0]},p={field:[void 0],op:["min","mean"],order:["ascending","descending"]},g={align:[void 0],type:[void 0,Xt.ScaleType.LOG],domain:[void 0],domainMax:[void 0],domainMid:[void 0],domainMin:[void 0],base:[void 0],exponent:[1,2],constant:[void 0],bins:[void 0],clamp:d,nice:d,reverse:d,round:d,zero:d,padding:[void 0],paddingInner:[void 0],paddingOuter:[void 0],interpolate:[void 0],range:[void 0],rangeMax:[void 0],rangeMin:[void 0],scheme:[void 0]},y={aria:[void 0],description:[void 0],zindex:[1,0],offset:[void 0],orient:[void 0],values:[void 0],bandPosition:[void 0],encoding:[void 0],domain:d,domainCap:[void 0],domainColor:[void 0],domainDash:[void 0],domainDashOffset:[void 0],domainOpacity:[void 0],domainWidth:[void 0],formatType:[void 0],grid:d,gridCap:[void 0],gridColor:[void 0],gridDash:[void 0],gridDashOffset:[void 0],gridOpacity:[void 0],gridWidth:[void 0],format:[void 0],labels:d,labelAlign:[void 0],labelAngle:[void 0],labelBaseline:[void 0],labelColor:[void 0],labelExpr:[void 0],labelFlushOffset:[void 0],labelFont:[void 0],labelFontSize:[void 0],labelFontStyle:[void 0],labelFontWeight:[void 0],labelLimit:[void 0],labelLineHeight:[void 0],labelOffset:[void 0],labelOpacity:[void 0],labelSeparation:[void 0],labelOverlap:[void 0],labelPadding:[void 0],labelBound:[void 0],labelFlush:[void 0],maxExtent:[void 0],minExtent:[void 0],position:[void 0],style:[void 0],ticks:d,tickBand:[void 0],tickCap:[void 0],tickColor:[void 0],tickCount:[void 0],tickDash:[void 0],tickExtra:[void 0],tickDashOffset:[void 0],tickMinStep:[void 0],tickOffset:[void 0],tickOpacity:[void 0],tickRound:[void 0],tickSize:[void 0],tickWidth:[void 0],title:[void 0],titleAlign:[void 0],titleAnchor:[void 0],titleAngle:[void 0],titleBaseline:[void 0],titleColor:[void 0],titleFont:[void 0],titleFontSize:[void 0],titleFontStyle:[void 0],titleFontWeight:[void 0],titleLimit:[void 0],titleLineHeight:[void 0],titleOpacity:[void 0],titlePadding:[void 0],titleX:[void 0],titleY:[void 0],translate:[void 0]},h={aria:[void 0],description:[void 0],orient:["left","right"],format:[void 0],type:[void 0],values:[void 0],zindex:[void 0],clipHeight:[void 0],columnPadding:[void 0],columns:[void 0],cornerRadius:[void 0],direction:[void 0],encoding:[void 0],fillColor:[void 0],formatType:[void 0],gridAlign:[void 0],offset:[void 0],padding:[void 0],rowPadding:[void 0],strokeColor:[void 0],labelAlign:[void 0],labelBaseline:[void 0],labelColor:[void 0],labelExpr:[void 0],labelFont:[void 0],labelFontSize:[void 0],labelFontStyle:[void 0],labelFontWeight:[void 0],labelLimit:[void 0],labelOffset:[void 0],labelOpacity:[void 0],labelOverlap:[void 0],labelPadding:[void 0],labelSeparation:[void 0],legendX:[void 0],legendY:[void 0],gradientLength:[void 0],gradientOpacity:[void 0],gradientStrokeColor:[void 0],gradientStrokeWidth:[void 0],gradientThickness:[void 0],symbolDash:[void 0],symbolDashOffset:[void 0],symbolFillColor:[void 0],symbolLimit:[void 0],symbolOffset:[void 0],symbolOpacity:[void 0],symbolSize:[void 0],symbolStrokeColor:[void 0],symbolStrokeWidth:[void 0],symbolType:[void 0],tickCount:[void 0],tickMinStep:[void 0],title:[void 0],titleAnchor:[void 0],titleAlign:[void 0],titleBaseline:[void 0],titleColor:[void 0],titleFont:[void 0],titleFontSize:[void 0],titleFontStyle:[void 0],titleFontWeight:[void 0],titleLimit:[void 0],titleLineHeight:[void 0],titleOpacity:[void 0],titleOrient:[void 0],titlePadding:[void 0]};n.DEFAULT_ENUM_INDEX={mark:[a.POINT,a.BAR,a.LINE,a.AREA,a.RECT,a.TICK,a.TEXT],channel:[Cn.X,Cn.Y,Cn.ROW,Cn.COLUMN,Cn.SIZE,Cn.COLOR],band:[void 0],aggregate:[void 0,"mean"],autoCount:d,bin:d,hasFn:d,timeUnit:[void 0,"year","month","minutes","seconds"],field:[void 0],type:[s.NOMINAL,s.ORDINAL,s.QUANTITATIVE,s.TEMPORAL],sort:["ascending","descending"],stack:["zero","normalize","center",null],value:[void 0],format:[void 0],title:[void 0],scale:[!0],axis:d,legend:d,binProps:f,sortProps:p,scaleProps:g,axisProps:y,legendProps:h},n.getDefaultEnumValues=function(e,t,n){if("field"===e||Jt.isEncodingNestedProp(e)&&"sort"===e.parent&&"field"===e.child)return t.fieldNames();let r;if(r=Jt.isEncodingNestedProp(e)?n.enum[e.parent+"Props"][e.child]:n.enum[e],void 0!==r)return r;throw new Error("No default enumValues for "+JSON.stringify(e))}})),Rn=n((function(t,n){var r=e&&e.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.extendConfig=n.DEFAULT_QUERY_CONFIG=void 0;const a=o(Cn);function s(e){return Object.assign(Object.assign(Object.assign({},Mn.DEFAULT_ENUM_INDEX),e),{binProps:c(e,"bin"),scaleProps:c(e,"scale"),axisProps:c(e,"axis"),legendProps:c(e,"legend")})}function c(e,t){return Object.assign(Object.assign({},Mn.DEFAULT_ENUM_INDEX[t+"Props"]),e[t+"Props"])}n.DEFAULT_QUERY_CONFIG={verbose:!1,defaultSpecConfig:{line:{point:!0},scale:{useUnaggregatedDomain:!0}},propertyPrecedence:Jt.DEFAULT_PROP_PRECEDENCE.map(Jt.toKey),enum:Mn.DEFAULT_ENUM_INDEX,numberNominalProportion:.05,numberNominalLimit:40,constraintManuallySpecifiedValue:!1,autoAddCount:!1,hasAppropriateGraphicTypeForMark:!0,omitAggregate:!1,omitAggregatePlotWithDimensionOnlyOnFacet:!0,omitAggregatePlotWithoutDimension:!1,omitBarLineAreaWithOcclusion:!0,omitBarTickWithSize:!0,omitMultipleNonPositionalChannels:!0,omitRaw:!1,omitRawContinuousFieldForAggregatePlot:!0,omitRepeatedField:!0,omitNonPositionalOrFacetOverPositionalChannels:!0,omitTableWithOcclusionIfAutoAddCount:!0,omitVerticalDotPlot:!1,omitInvalidStackSpec:!0,omitNonSumStack:!0,preferredBinAxis:a.X,preferredTemporalAxis:a.X,preferredOrdinalAxis:a.Y,preferredNominalAxis:a.Y,preferredFacet:a.ROW,minCardinalityForBin:15,maxCardinalityForCategoricalColor:20,maxCardinalityForFacet:20,maxCardinalityForShape:6,timeUnitShouldHaveVariation:!0,typeMatchesSchemaType:!0,stylize:!0,smallRangeStepForHighCardinalityOrFacet:{maxCardinality:10,rangeStep:12},nominalColorScaleForHighCardinality:{maxCardinality:10,palette:"category20"},xAxisOnTopForHighYCardinalityWithoutColumn:{maxCardinality:30},maxGoodCardinalityForFacet:5,maxGoodCardinalityForColor:7,minPercentUniqueForKey:.8,minCardinalityForKey:50},n.extendConfig=function(e){return Object.assign(Object.assign(Object.assign({},n.DEFAULT_QUERY_CONFIG),e),{enum:s(e.enum)})}}));const wn={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1};function Un(e){return!!e&&!!e.argmin}function Fn(e){return!!e&&!!e.argmax}const xn=I(wn);function Ln(e){return b(e)&&!!wn[e]}const kn=["count","valid","missing","distinct"];function jn(e){return b(e)&&N(kn,e)}const Bn=["count","sum","distinct","valid","missing"],Wn=["mean","average","median","q1","q3","min","max"],Yn=_(Wn);var Gn=Object.freeze({__proto__:null,MULTIDOMAIN_SORT_OP_INDEX:{count:1,min:1,max:1},isArgminDef:Un,isArgmaxDef:Fn,AGGREGATE_OPS:xn,isAggregateOp:Ln,COUNTING_OPS:kn,isCountingAggregateOp:jn,isMinMaxOp:function(e){return b(e)&&N(["min","max"],e)},SUM_OPS:Bn,SHARED_DOMAIN_OPS:Wn,SHARED_DOMAIN_OP_INDEX:Yn});function Qn(e){return T(e)&&(e=ti(e,void 0)),"bin"+I(e).map((t=>zn(e[t])?M(`_${t}_${D(e[t])}`):M(`_${t}_${e[t]}`))).join("")}function $n(e){return!0===e||qn(e)&&!e.binned}function Hn(e){return"binned"===e||qn(e)&&!0===e.binned}function qn(e){return h(e)}function zn(e){return null==e?void 0:e.selection}function Vn(e){switch(e){case x:case L:case te:case X:case J:case Z:case ae:case re:case ie:case oe:case ee:return 6;case se:return 4;default:return 10}}var Kn=Object.freeze({__proto__:null,binToString:Qn,isBinning:$n,isBinned:Hn,isBinParams:qn,isSelectionExtent:zn,autoMaxBins:Vn});function Xn(e,t,n,{vgChannel:r}={}){return w(r?Jn(e,t,n.style):void 0,Jn(e,t,n.style),r?n[t.type][r]:void 0,n[t.type][e],r?n.mark[r]:n.mark[e])}function Jn(e,t,n){return function(e,t,n){let r;t=E(t);for(const i of t){const t=n[i];t&&void 0!==t[e]&&(r=t[e])}return r}(e,function(e){var t;return[].concat(e.type,null!==(t=e.style)&&void 0!==t?t:[])}(t),n)}function Zn(e){if(e&&h(e))for(const t of cr)if(t in e)return!0;return!1}const er=["january","february","march","april","may","june","july","august","september","october","november","december"],tr=er.map((e=>e.substr(0,3))),nr=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],rr=nr.map((e=>e.substr(0,3)));function ir(e,t){const n=[];if(t&&void 0!==e.day&&I(e).length>1&&(dt(function(e){return`Dropping day from datetime ${A(e)} as day cannot be combined with other units.`}(e)),delete(e=S(e)).day),void 0!==e.year?n.push(e.year):n.push(2012),void 0!==e.month){const r=t?function(e){if(U(e)&&(e=+e),v(e))return e-1;{const t=e.toLowerCase(),n=er.indexOf(t);if(-1!==n)return n;const r=t.substr(0,3),i=tr.indexOf(r);if(-1!==i)return i;throw new Error(ut("month",e))}}(e.month):e.month;n.push(r)}else if(void 0!==e.quarter){const r=t?function(e){if(U(e)&&(e=+e),v(e))return e>4&&dt(ut("quarter",e)),e-1;throw new Error(ut("quarter",e))}(e.quarter):e.quarter;n.push(v(r)?3*r:r+"*3")}else n.push(0);if(void 0!==e.date)n.push(e.date);else if(void 0!==e.day){const r=t?function(e){if(U(e)&&(e=+e),v(e))return e%7;{const t=e.toLowerCase(),n=nr.indexOf(t);if(-1!==n)return n;const r=t.substr(0,3),i=rr.indexOf(r);if(-1!==i)return i;throw new Error(ut("day",e))}}(e.day):e.day;n.push(v(r)?r+1:r+"+1")}else n.push(1);for(const t of["hours","minutes","seconds","milliseconds"]){const r=e[t];n.push(void 0===r?0:r)}return n}function or(e){const t=ir(e,!0).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}var ar=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const sr={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},cr=I(sr);function ur(e){return!!sr[e]}function lr(e){return e.startsWith("utc")}function dr(e){return e.substr(3)}const fr={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function pr(e){const t=[];for(const n of cr)gr(e,n)&&t.push(n);return t}function gr(e,t){const n=e.indexOf(t);return!(n<0)&&(!(n>0&&"seconds"===t&&"i"===e.charAt(n-1))&&(!(e.length>n+3&&"day"===t&&"o"===e.charAt(n+3))&&!(n>0&&"year"===t&&"f"===e.charAt(n-1))))}function yr(e){if(!e)return;const t=pr(e);return`timeUnitSpecifier(${o(t)}, ${o(fr)})`}function hr(e){if(!e)return;let t;return b(e)?t={unit:e}:h(e)&&(t=Object.assign(Object.assign({},e),e.unit?{unit:e.unit}:{})),lr(t.unit)&&(t.utc=!0,t.unit=dr(t.unit)),t}function mr(e){const t=hr(e),{utc:n}=t,r=ar(t,["utc"]);return r.unit?(n?"utc":"")+I(r).map((e=>M(`${"unit"===e?"":`_${e}_`}${r[e]}`))).join(""):(n?"utc":"")+"timeunit"+I(r).map((e=>M(`_${e}_${r[e]}`))).join("")}var Er=Object.freeze({__proto__:null,LOCAL_SINGLE_TIMEUNIT_INDEX:sr,TIMEUNIT_PARTS:cr,isLocalSingleTimeUnit:ur,UTC_SINGLE_TIMEUNIT_INDEX:{utcyear:1,utcquarter:1,utcmonth:1,utcweek:1,utcday:1,utcdayofyear:1,utcdate:1,utchours:1,utcminutes:1,utcseconds:1,utcmilliseconds:1},LOCAL_MULTI_TIMEUNIT_INDEX:{yearquarter:1,yearquartermonth:1,yearmonth:1,yearmonthdate:1,yearmonthdatehours:1,yearmonthdatehoursminutes:1,yearmonthdatehoursminutesseconds:1,yearweek:1,yearweekday:1,yearweekdayhours:1,yearweekdayhoursminutes:1,yearweekdayhoursminutesseconds:1,yeardayofyear:1,quartermonth:1,monthdate:1,monthdatehours:1,monthdatehoursminutes:1,monthdatehoursminutesseconds:1,weekday:1,weeksdayhours:1,weekdayhoursminutes:1,weekdayhoursminutesseconds:1,dayhours:1,dayhoursminutes:1,dayhoursminutesseconds:1,hoursminutes:1,hoursminutesseconds:1,minutesseconds:1,secondsmilliseconds:1},UTC_MULTI_TIMEUNIT_INDEX:{utcyearquarter:1,utcyearquartermonth:1,utcyearmonth:1,utcyearmonthdate:1,utcyearmonthdatehours:1,utcyearmonthdatehoursminutes:1,utcyearmonthdatehoursminutesseconds:1,utcyearweek:1,utcyearweekday:1,utcyearweekdayhours:1,utcyearweekdayhoursminutes:1,utcyearweekdayhoursminutesseconds:1,utcyeardayofyear:1,utcquartermonth:1,utcmonthdate:1,utcmonthdatehours:1,utcmonthdatehoursminutes:1,utcmonthdatehoursminutesseconds:1,utcweekday:1,utcweeksdayhours:1,utcweekdayhoursminutes:1,utcweekdayhoursminutesseconds:1,utcdayhours:1,utcdayhoursminutes:1,utcdayhoursminutesseconds:1,utchoursminutes:1,utchoursminutesseconds:1,utcminutesseconds:1,utcsecondsmilliseconds:1},isUTCTimeUnit:lr,getLocalTimeUnit:dr,VEGALITE_TIMEFORMAT:fr,getTimeUnitParts:pr,containsTimeUnit:gr,fieldExpr:function(e,t,{end:n}={end:!1}){const r=function(e,t="datum"){const n=d(e),r=[];for(let e=1;e<=n.length;e++){const i=`[${n.slice(0,e).map(P).join("][")}]`;r.push(`${t}${i}`)}return r.join(" && ")}(t),i=lr(e)?"utc":"";let o;const a={};for(const t of cr)gr(e,t)&&(a[t]="quarter"===(s=t)?`(${i}quarter(${r})-1)`:`${i}${s}(${r})`,o=t);var s;return n&&(a[o]+="+1"),function(e){const t=ir(e,!1).join(", ");return e.utc?`utc(${t})`:`datetime(${t})`}(a)},timeUnitSpecifierExpression:yr,formatExpression:function(e,t,n){if(!e)return;const r=yr(e);return`${n||lr(e)?"utc":"time"}Format(${t}, ${r})`},normalizeTimeUnit:hr,timeUnitToString:mr});function Or(e){return e&&"number"!==e&&"time"!==e}const Tr={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function vr(e){return e in Tr}function br(e){return!!e&&"header"in e}var Pr=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function _r(e){return"sort"in e}function Sr({channel:e,fieldDef:t,fieldDef2:n,markDef:r,stack:i,config:o,isMidPoint:a}){if(Rr(t)&&void 0!==t.band)return t.band;if(Cr(t)){const{timeUnit:e,bin:i}=t;if(e&&!n)return a?Xn("timeUnitBandPosition",r,o):hn(r.type)?Xn("timeUnitBand",r,o):0;if($n(i))return hn(r.type)&&!a?1:.5}return(null==i?void 0:i.fieldChannel)===e&&a?.5:void 0}function Ar(e){const t=e&&e.condition;return!!t&&!y(t)&&Cr(t)}function Nr(e){const t=e&&e.condition;return!!t&&!y(t)&&Rr(t)}function Cr(e){return!(!e||!e.field&&"count"!==e.aggregate)}function Ir(e){return e&&e.type}function Dr(e){return!!e&&"datum"in e}function Mr(e){return Dr(e)&&v(e.datum)}function Rr(e){return Cr(e)||Dr(e)}function wr(e){return!!e&&("field"in e||"count"===e.aggregate)&&"type"in e}function Ur(e){return e&&"value"in e&&"value"in e}function Fr(e){return!!e&&("scale"in e||"sort"in e)}function xr(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function Lr(e){return!!e&&"legend"in e}function kr(e){return!!e&&("format"in e||"formatType"in e)}function jr(e,t={}){var n,r,i;let o=e.field;const a=t.prefix;let s=t.suffix,c="";if(Yr(e))o=function(e){return function(e){return 0===e.indexOf("__")}(e)?e:"__"+e}("count");else{let a;if(!t.nofn)if(function(e){return"op"in e}(e))a=e.op;else{const{bin:u,aggregate:l,timeUnit:d}=e;$n(u)?(a=Qn(u),s=(null!==(n=t.binSuffix)&&void 0!==n?n:"")+(null!==(r=t.suffix)&&void 0!==r?r:"")):l?Fn(l)?(c=`["${o}"]`,o="argmax_"+l.argmax):Un(l)?(c=`["${o}"]`,o="argmin_"+l.argmin):a=String(l):d&&(a=mr(d),s=(!N(["range","mid"],t.binSuffix)&&t.binSuffix||"")+(null!==(i=t.suffix)&&void 0!==i?i:""))}a&&(o=o?`${a}_${o}`:a)}return s&&(o=`${o}_${s}`),a&&(o=`${a}_${o}`),t.forAs?""+d(o).join("."):t.expr?function(e,t="datum"){return`${t}[${P(d(e).join("."))}]`}(o,t.expr)+c:function(e){return""+d(e).map(R).join("\\.")}(o)+c}function Br(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return Cr(e)&&!!e.bin;case"temporal":return!1}throw new Error(at(e.type))}function Wr(e){return!Br(e)}function Yr(e){return"count"===e.aggregate}function Gr(e,t){var n;const{field:r,bin:i,timeUnit:o,aggregate:a}=e;if("count"===a)return t.countTitle;if($n(i))return r+" (binned)";if(o){const e=null===(n=hr(o))||void 0===n?void 0:n.unit;if(e)return`${r} (${pr(e).join("-")})`}else if(a)return Fn(a)?`${r} for max ${a.argmax}`:Un(a)?`${r} for min ${a.argmin}`:`${s=a,s.charAt(0).toUpperCase()+s.substr(1)} of ${r}`;var s;return r}function Qr(e){const{aggregate:t,bin:n,timeUnit:r,field:i}=e;if(Fn(t))return`${i} for argmax(${t.argmax})`;if(Un(t))return`${i} for argmin(${t.argmin})`;const o=hr(r),a=t||(null==o?void 0:o.unit)||(null==o?void 0:o.maxbins)&&"timeunit"||$n(n)&&"bin";return a?a.toUpperCase()+"("+i+")":i}const $r=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return Qr(e);default:return Gr(e,t)}};let Hr=$r;function qr(e){Hr=e}function zr(e){return xr(e)&&e.axis?e.axis:Lr(e)&&e.legend?e.legend:br(e)&&e.header?e.header:void 0}function Vr(e,t){return Hr(e,t)}function Kr(e){var t;if(kr(e)){const{format:t,formatType:n}=e;return{format:t,formatType:n}}{const n=null!==(t=zr(e))&&void 0!==t?t:{},{format:r,formatType:i}=n;return{format:r,formatType:i}}}function Xr(e,t){var n;switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(_r(e)&&y(e.sort))return"ordinal";const{aggregate:r,bin:i,timeUnit:o}=e;if(o)return"temporal";if(i||r&&!Fn(r)&&!Un(r))return"quantitative";if(Fr(e)&&(null===(n=e.scale)||void 0===n?void 0:n.type))switch(Pt[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}function Jr(e){return Cr(e)?e:Ar(e)?e.condition:void 0}function Zr(e,t,n,r){if(kr(e)){const{format:i,formatType:o}=e,a=Pr(e,["format","formatType"]);if(Or(o)&&!n.customFormatTypes)return dt(ot(t)),Zr(a,t,n,r)}else{const i=xr(e)?"axis":Lr(e)?"legend":br(e)?"header":null;if(i&&e[i]){const o=e[i],{format:a,formatType:s}=o,c=Pr(o,["format","formatType"]);if(Or(s)&&!n.customFormatTypes)return dt(ot(t)),Zr(Object.assign(Object.assign({},e),{[i]:c}),t,n,r)}}return Cr(e)?ei(e,t,r):function(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=v(n)?"quantitative":b(n)?"nominal":Zn(n)?"temporal":void 0,Object.assign(Object.assign({},e),{type:t})}(e)}function ei(e,t,{compositeMark:n=!1}={}){const{aggregate:r,timeUnit:i,bin:o,field:a}=e,s=Object.assign({},e);if(n||!r||Ln(r)||Fn(r)||Un(r)||(dt(function(e){return`Invalid aggregation operator "${e}".`}(r)),delete s.aggregate),i&&(s.timeUnit=hr(i)),a&&(s.field=""+a),$n(o)&&(s.bin=ti(o,t)),Hn(o)&&!je(t)&&dt(function(e){return`Channel ${e} should not be used with "binned" bin.`}(t)),wr(s)){const{type:e}=s,t=Ot(e);e!==t&&(s.type=t),"quantitative"!==e&&jn(r)&&(dt(function(e,t){return`Invalid field type "${e}" for aggregate: "${t}", using "quantitative" instead.`}(e,r)),s.type="quantitative")}else if(!Me(t)){const e=Xr(s,t);s.type=e}if(wr(s)){const{compatible:e,warning:n}=ri(s,t)||{};!1===e&&dt(n)}if(_r(s)&&b(s.sort)){const{sort:e}=s;if(vr(e))return Object.assign(Object.assign({},s),{sort:{encoding:e}});const t=e.substr(1);if("-"===e.charAt(0)&&vr(t))return Object.assign(Object.assign({},s),{sort:{encoding:t,order:"descending"}})}if(br(s)){const{header:e}=s,{orient:t}=e,n=Pr(e,["orient"]);if(t)return Object.assign(Object.assign({},s),{header:Object.assign(Object.assign({},n),{labelOrient:e.labelOrient||t,titleOrient:e.titleOrient||t})})}return s}function ti(e,t){return T(e)?{maxbins:Vn(t)}:"binned"===e?{binned:!0}:e.maxbins||e.step?e:Object.assign(Object.assign({},e),{maxbins:Vn(t)})}const ni={compatible:!0};function ri(e,t){const n=e.type;if("geojson"===n&&"shape"!==t)return{compatible:!1,warning:`Channel ${t} should not be used with a geojson data.`};switch(t){case x:case L:case k:return Wr(e)?{compatible:!1,warning:st(t)}:ni;case j:case B:case X:case J:case Z:case ce:case le:case de:case fe:case pe:case ge:case ne:case $:case G:case ye:return ni;case z:case K:case q:case V:return n!==pt?{compatible:!1,warning:`Channel ${t} should be used with a quantitative field only, not ${e.type} field.`}:ni;case re:case ie:case oe:case ae:case te:case H:case Q:case W:case Y:return"nominal"!==n||e.sort?ni:{compatible:!1,warning:`Channel ${t} should not be used with an unsorted discrete field.`};case se:return N(["ordinal","nominal"],e.type)?ni:{compatible:!1,warning:"StrokeDash channel should be used with only discrete data."};case ee:return N(["ordinal","nominal","geojson"],e.type)?ni:{compatible:!1,warning:"Shape channel should be used with only either discrete or geojson data."};case ue:return"nominal"!==e.type||"sort"in e?ni:{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}}}function ii(e){return e&&("temporal"===e.type||Cr(e)&&!!e.timeUnit)}function oi(e,{timeUnit:t,type:n,wrapTime:r,undefinedIfExprNotRequired:i}){var o;const a=t&&(null===(o=hr(t))||void 0===o?void 0:o.unit);let s,c=a||"temporal"===n;var u;return(u=e)&&u.expr?s=e.expr:!function(e){return e&&!!e.signal}(e)?Zn(e)?(c=!0,s=or(e)):(b(e)||v(e))&&c&&(s=`datetime(${JSON.stringify(e)})`,ur(a)&&(v(e)&&e<1e4||b(e)&&isNaN(Date.parse(e)))&&(s=or({[a]:e}))):s=e.signal,s?r&&c?`time(${s})`:s:i?void 0:JSON.stringify(e)}var ai=Object.freeze({__proto__:null,isConditionalSelection:function(e){return e.selection},isRepeatRef:function(e){return e&&!b(e)&&"repeat"in e},toFieldDefBase:function(e){const{field:t,timeUnit:n,bin:r,aggregate:i}=e;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),r?{bin:r}:{}),i?{aggregate:i}:{}),{field:t})},isSortableFieldDef:_r,getBand:Sr,hasBand:function(e,t,n,r,i,o){return!!($n(t.bin)||t.timeUnit&&wr(t)&&"temporal"===t.type)&&!!Sr({channel:e,fieldDef:t,fieldDef2:n,stack:r,markDef:i,config:o})},isConditionalDef:function(e){return!!e&&"condition"in e},hasConditionalFieldDef:Ar,hasConditionalFieldOrDatumDef:Nr,hasConditionalValueDef:function(e){const t=e&&e.condition;return!!t&&(y(t)||Ur(t))},isFieldDef:Cr,channelDefType:Ir,isDatumDef:Dr,isContinuousFieldOrDatumDef:function(e){return wr(e)&&Wr(e)||Mr(e)},isQuantitativeFieldOrDatumDef:function(e){return"quantitative"===Ir(e)||Mr(e)},isNumericDataDef:Mr,isFieldOrDatumDef:Rr,isTypedFieldDef:wr,isValueDef:Ur,isScaleFieldDef:Fr,isPositionFieldOrDatumDef:xr,isMarkPropFieldOrDatumDef:Lr,isStringFieldOrDatumDef:kr,toStringFieldDef:function(e){return function(e,t){const n=Object.assign({},e);for(const e of t)delete n[e];return n}(e,["legend","axis","header","scale"])},vgField:jr,isDiscrete:Br,isContinuous:Wr,isCount:Yr,verbalTitleFormatter:Gr,functionalTitleFormatter:Qr,defaultTitleFormatter:$r,setTitleFormatter:qr,resetTitleFormatter:function(){qr($r)},title:function(e,t,{allowDisabling:n,includeDefault:r=!0}){var i,o;const a=null===(i=zr(e))||void 0===i?void 0:i.title;if(!Cr(e))return a;const s=e,c=r?Vr(s,t):void 0;return n?w(a,s.title,c):null!==(o=null!=a?a:s.title)&&void 0!==o?o:c},getGuide:zr,defaultTitle:Vr,getFormatMixins:Kr,defaultType:Xr,getFieldDef:Jr,getFieldOrDatumDef:function(e){return Rr(e)?e:Nr(e)?e.condition:void 0},initChannelDef:function(e,t,n,r={}){if(b(e)||v(e)||T(e)){return dt(function(e,t,n){return`Channel ${e} is a ${t}. Converted to {value: ${A(n)}}.`}(t,b(e)?"string":v(e)?"number":"boolean",e)),{value:e}}return Rr(e)?Zr(e,t,n,r):Nr(e)?Object.assign(Object.assign({},e),{condition:Zr(e.condition,t,n,r)}):e},initFieldOrDatumDef:Zr,initFieldDef:ei,normalizeBin:ti,channelCompatibility:ri,isFieldOrDatumDefForTimeFormat:function(e){const{formatType:t}=Kr(e);return"time"===t||!t&&ii(e)},isTimeFieldDef:ii,valueExpr:oi,valueArray:function(e,t){const{type:n}=e;return t.map((t=>{const r=oi(t,{timeUnit:Cr(e)?e.timeUnit:void 0,type:n,undefinedIfExprNotRequired:!0});return void 0!==r?{signal:r}:t}))},binRequiresRange:function(e,t){return $n(e.bin)?He(t)&&N(["ordinal","nominal"],e.type):(console.warn("Only call this method for binned field defs."),!1)}});var si=Object.freeze({__proto__:null,scaleType:function(e,t,n,r){const i=function(e,t,n){var r;switch(t.type){case"nominal":case"ordinal":if(ve(e)||"discrete"===Ve(e))return"shape"===e&&"ordinal"===t.type&&dt(ct(e,"ordinal")),"ordinal";if(e in Le){if(N(["rect","bar","image","rule"],n))return"band"}else if("arc"===n&&e in Be)return"band";return void 0!==t.band||xr(t)&&(null===(r=t.axis)||void 0===r?void 0:r.tickBand)?"band":"point";case"temporal":return ve(e)?"time":"discrete"===Ve(e)?(dt(ct(e,"temporal")),"ordinal"):Cr(t)&&t.timeUnit&&hr(t.timeUnit).utc?"utc":"time";case"quantitative":return ve(e)?Cr(t)&&$n(t.bin)?"bin-ordinal":"linear":"discrete"===Ve(e)?(dt(ct(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(at(t.type))}(t,n,r),{type:o}=e;return He(t)?void 0!==o?$t(t,o)?Cr(n)&&!Qt(o,n.type)?(dt(function(e,t){return`FieldDef does not work with "${e}" scale. We are using "${t}" scale instead.`}(o,i)),i):o:(dt(function(e,t,n){return`Channel "${e}" does not work with "${t}" scale. We are using "${n}" scale instead.`}(t,o,i)),i):i:null}}),ci=n((function(t,n){var r=e&&e.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.isDiscrete=n.ExpandedType=void 0;const a=o(Dn);var s;!function(e){e.QUANTITATIVE=a.QUANTITATIVE,e.ORDINAL=a.ORDINAL,e.TEMPORAL=a.TEMPORAL,e.NOMINAL=a.NOMINAL,e.KEY="key"}(s=n.ExpandedType||(n.ExpandedType={})),n.isDiscrete=function(e){return e===a.ORDINAL||e===a.NOMINAL||e===s.KEY}})),ui=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PropIndex=void 0;class n{constructor(e=null){this.index=e?Object.assign({},e):{}}has(e){return Jt.toKey(e)in this.index}get(e){return this.index[Jt.toKey(e)]}set(e,t){return this.index[Jt.toKey(e)]=t,this}setByKey(e,t){this.index[e]=t}map(e){const t=new n;for(const n in this.index)t.index[n]=e(this.index[n]);return t}size(){return zt.keys(this.index).length}duplicate(){return new n(this.index)}}t.PropIndex=n}));function li(e,t){const n=e&&e[t];return!!n&&(y(n)?C(n,(e=>!!e.field)):Cr(n)||Ar(n))}const di={zero:1,center:1,normalize:1};function fi(e){return e in di}const pi=new Set([en,nn,tn,cn,an,fn,pn,on,un,ln]),gi=new Set([nn,tn,en]);function yi(e,t){var n,r;const i="x"===t?"y":"radius",o=e[t],a=e[i];if(Cr(o)&&Cr(a))if("quantitative"===Ir(o)&&"quantitative"===Ir(a)){if(o.stack)return t;if(a.stack)return i;const e=Cr(o)&&!!o.aggregate;if(e!==(Cr(a)&&!!a.aggregate))return e?t:i;{const e=null===(n=o.scale)||void 0===n?void 0:n.type,s=null===(r=a.scale)||void 0===r?void 0:r.type;if(e&&"linear"!==e)return i;if(s&&"linear"!==s)return t}}else{if("quantitative"===Ir(o))return t;if("quantitative"===Ir(a))return i}else{if("quantitative"===Ir(o))return t;if("quantitative"===Ir(a))return i}}var hi=r(Object.freeze({__proto__:null,isStackOffset:fi,STACKABLE_MARKS:pi,STACK_BY_DEFAULT_MARKS:gi,stack:function(e,t,n={}){const r=En(e)?e.type:e;if(!pi.has(r))return null;const i=yi(t,"x")||yi(t,"theta");if(!i)return null;const o=t[i],a=Cr(o)?jr(o,{}):void 0;let s=function(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}(i),c=t[s],u=Cr(c)?jr(c,{}):void 0;u===a&&(u=void 0,c=void 0,s=void 0);const l=xe.reduce(((e,n)=>{if("tooltip"!==n&&li(t,n)){const r=t[n];for(const t of E(r)){const r=Jr(t);if(r.aggregate)continue;const i=jr(r,{});i&&i===u||e.push({channel:n,fieldDef:r})}}return e}),[]);let d;if(void 0!==o.stack?d=T(o.stack)?o.stack?"zero":null:o.stack:l.length>0&&gi.has(r)&&(d="zero"),!d||!fi(d))return null;if(function(e){return C(Se,(t=>{if(li(e,t)){const n=e[t];if(y(n))return C(n,(e=>!!e.aggregate));{const e=Jr(n);return e&&!!e.aggregate}}return!1}))}(t)&&0===l.length)return null;if(o.scale&&o.scale.type&&o.scale.type!==bt.LINEAR){if(n.disallowNonLinearStack)return null;dt(function(e){return`Cannot stack non-linear scale (${e}).`}(o.scale.type))}return Rr(t[we(i)])?(void 0!==o.stack&&dt(function(e){return`Cannot stack "${e}" if there is already "${e}2".`}(i)),null):(Cr(o)&&o.aggregate&&!N(Bn,o.aggregate)&&dt(function(e){return`Stacking is applied even though the aggregate function is non-summative ("${e}").`}(o.aggregate)),{groupbyChannel:c?s:void 0,groupbyField:u,fieldChannel:i,impute:null!==o.impute&&yn(r),stackBy:l,offset:d})}})),mi=n((function(e,t){function n(e){if(Mn.isWildcard(e.mark))return!1;const t=[Jt.Property.STACK,Jt.Property.CHANNEL,Jt.Property.MARK,Jt.Property.FIELD,Jt.Property.AGGREGATE,Jt.Property.AUTOCOUNT,Jt.Property.SCALE,Jt.getEncodingNestedProp("scale","type"),Jt.Property.TYPE],n=qt.toMap(zt.without(Jt.ALL_ENCODING_PROPS,t)),i=e.encodings.filter((e=>!Pi.isDisabledAutoCountQuery(e)));for(const e of i)if(r(e,{exclude:n}))return!1;return!0}function r(e,t={}){if(!zt.isObject(e))return!1;for(const n in e)if(e.hasOwnProperty(n)){if(Mn.isWildcard(e[n])&&(!t.exclude||!t.exclude[n])||r(e[n],t))return!0}return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.hasWildcard=t.hasRequiredStackProperties=t.getStackChannel=t.getStackOffset=t.getVlStack=t.isAggregate=t.fromSpec=void 0,t.fromSpec=function(e){return zt.extend(e.data?{data:e.data}:{},e.transform?{transform:e.transform}:{},e.width?{width:e.width}:{},e.height?{height:e.height}:{},e.background?{background:e.background}:{},e.padding?{padding:e.padding}:{},e.title?{title:e.title}:{},{mark:e.mark,encodings:zt.keys(e.encoding).map((t=>{let n={channel:t},r=e.encoding[t];for(const e in r)Jt.isEncodingTopLevelProperty(e)&&void 0!==r[e]&&(zt.contains(["bin","scale","axis","legend"],e)&&null===r[e]?n[e]=!1:n[e]=r[e]);return Pi.isFieldQuery(n)&&"count"===n.aggregate&&!n.field&&(n.field="*"),n}))},e.config?{config:e.config}:{})},t.isAggregate=function(e){return zt.some(e.encodings,(e=>Pi.isFieldQuery(e)&&!Mn.isWildcard(e.aggregate)&&!!e.aggregate||Pi.isEnabledAutoCountQuery(e)))},t.getVlStack=function(e){if(!n(e))return null;const t=Pi.toEncoding(e.encodings,{schema:null,wildcardMode:"null"}),r=e.mark;return hi.stack(r,t,{disallowNonLinearStack:!0})},t.getStackOffset=function(e){for(const t of e.encodings)if(void 0!==t[Jt.Property.STACK]&&!Mn.isWildcard(t[Jt.Property.STACK]))return t[Jt.Property.STACK]},t.getStackChannel=function(e){for(const t of e.encodings)if(void 0!==t[Jt.Property.STACK]&&!Mn.isWildcard(t.channel))return t.channel;return null},t.hasRequiredStackProperties=n,t.hasWildcard=function(e,t={}){const n=t.exclude?qt.toMap(t.exclude.map(Jt.toKey)):{};if(Mn.isWildcard(e.mark)&&!n.mark)return!0;for(const t of e.encodings)if(r(t,n))return!0;return!1}})),Ei=r(Gn),Oi=r(Er),Ti=n((function(t,n){var r=e&&e.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.shorthandParser=n.splitWithTail=n.parse=n.fieldDef=n.encoding=n.spec=n.PROPERTY_SUPPORTED_CHANNELS=n.vlSpec=n.INCLUDE_ALL=n.REPLACE_NONE=n.replace=n.value=n.getReplacer=n.getReplacerIndex=void 0;const a=o(Dn),s=Dn;function c(e){return t=>void 0!==e[t]?e[t]:t}function u(e,t){return Mn.isWildcard(e)?!Mn.isShortWildcard(e)&&e.enum?Mn.SHORT_WILDCARD+JSON.stringify(e.enum):Mn.SHORT_WILDCARD:t?t(e):e}function l(e,t){return t?t(e):e}function d(e,t=n.INCLUDE_ALL,r=n.REPLACE_NONE){const i=[];let o;if(t.get(Jt.Property.MARK)&&i.push(u(e.mark,r.get(Jt.Property.MARK))),e.transform&&e.transform.length>0&&i.push("transform:"+JSON.stringify(e.transform)),t.get(Jt.Property.STACK)&&(o=mi.getVlStack(e)),e.encodings){const n=e.encodings.reduce(((e,n)=>{if(!Pi.isDisabledAutoCountQuery(n)){let i;i=o&&n.channel===o.fieldChannel?f(Object.assign(Object.assign({},n),{stack:o.offset}),t,r):f(n,t,r),i&&e.push(i)}return e}),[]).sort().join("|");n&&i.push(n)}for(let n of Jt.VIEW_PROPS){const r=n.toString();if(t.get(n)&&e[r]){const t=e[r];i.push(`${r}=${JSON.stringify(t)}`)}}return i.join("|")}function f(e,t=n.INCLUDE_ALL,r=n.REPLACE_NONE){const i=[];if(t.get(Jt.Property.CHANNEL)&&i.push(u(e.channel,r.get(Jt.Property.CHANNEL))),Pi.isFieldQuery(e)){const n=p(e,t,r);n&&i.push(n)}else Pi.isValueQuery(e)?i.push(e.value):Pi.isAutoCountQuery(e)&&i.push("autocount()");return i.join(":")}function p(e,t=n.INCLUDE_ALL,r=n.REPLACE_NONE){if(t.get(Jt.Property.AGGREGATE)&&Pi.isDisabledAutoCountQuery(e))return"-";const i=function(e,t,n){if(t.get(Jt.Property.AGGREGATE)&&e.aggregate&&!Mn.isWildcard(e.aggregate))return l(e.aggregate,n.get(Jt.Property.AGGREGATE));if(t.get(Jt.Property.AGGREGATE)&&Pi.isEnabledAutoCountQuery(e))return l("count",n.get(Jt.Property.AGGREGATE));if(t.get(Jt.Property.TIMEUNIT)&&e.timeUnit&&!Mn.isWildcard(e.timeUnit))return l(e.timeUnit,n.get(Jt.Property.TIMEUNIT));if(t.get(Jt.Property.BIN)&&e.bin&&!Mn.isWildcard(e.bin))return"bin";{let n=null;for(const r of[Jt.Property.AGGREGATE,Jt.Property.AUTOCOUNT,Jt.Property.TIMEUNIT,Jt.Property.BIN]){const i=e[r];t.get(r)&&e[r]&&Mn.isWildcard(i)&&(n=n||{},n[r]=Mn.isShortWildcard(i)?i:i.enum)}return n&&e.hasFn&&(n.hasFn=!0),n}}(e,t,r),o=function(e,t,r){const i=[];if(!zt.isBoolean(e.bin)&&!Mn.isShortWildcard(e.bin)){const n=e.bin;for(const e in n){const o=Jt.getEncodingNestedProp("bin",e);o&&t.get(o)&&void 0!==n[e]&&i.push({key:e,value:u(n[e],r.get(o))})}i.sort(((e,t)=>e.key.localeCompare(t.key)))}for(const o of[Jt.Property.SCALE,Jt.Property.SORT,Jt.Property.STACK,Jt.Property.AXIS,Jt.Property.LEGEND])if((Mn.isWildcard(e.channel)||n.PROPERTY_SUPPORTED_CHANNELS[o][e.channel])&&t.get(o)&&void 0!==e[o]){const n=e[o];if(zt.isBoolean(n)||null===n)i.push({key:""+o,value:n||!1});else if(qt.isString(n))i.push({key:""+o,value:l(JSON.stringify(n),r.get(o))});else{let e=[];for(const i in n){const a=Jt.getEncodingNestedProp(o,i);a&&t.get(a)&&void 0!==n[i]&&e.push({key:i,value:u(n[i],r.get(a))})}if(e.length>0){const t=e.sort(((e,t)=>e.key.localeCompare(t.key))).reduce(((e,t)=>(e[t.key]=t.value,e)),{});i.push({key:""+o,value:JSON.stringify(t)})}}}return i}(e,t,r);let s;if(Pi.isFieldQuery(e)){if(s=t.get("field")?u(e.field,r.get("field")):"...",t.get(Jt.Property.TYPE))if(Mn.isWildcard(e.type))s+=","+u(e.type,r.get(Jt.Property.TYPE));else{s+=","+u((""+(e.type||a.QUANTITATIVE)).substr(0,1),r.get(Jt.Property.TYPE))}s+=o.map((e=>{let t=e.value instanceof Array?`[${e.value}]`:e.value;return`,${e.key}=${t}`})).join("")}else Pi.isAutoCountQuery(e)&&(s="*,q");if(!s)return null;if(i){return`${qt.isString(i)?i:Mn.SHORT_WILDCARD+(zt.keys(i).length>0?JSON.stringify(i):"")}(${s})`}return s}function g(e,t,n){let r=[],i=0;for(let o=0;o<n;o++){let n=e.indexOf(t,i);if(-1===n)break;r.push(e.substring(i,n)),i=n+1}if(r.push(e.substr(i)),r.length!==n+1)for(;r.length!==n+1;)r.push("");return r}var y;n.getReplacerIndex=function(e){return e.map((e=>c(e)))},n.getReplacer=c,n.value=u,n.replace=l,n.REPLACE_NONE=new ui.PropIndex,n.INCLUDE_ALL=[].concat(Jt.DEFAULT_PROP_PRECEDENCE,Jt.SORT_PROPS,[Jt.Property.TRANSFORM,Jt.Property.STACK],Jt.VIEW_PROPS).reduce(((e,t)=>e.set(t,!0)),new ui.PropIndex),n.vlSpec=function(e,t=n.INCLUDE_ALL,r=n.REPLACE_NONE){return d(mi.fromSpec(e),t,r)},n.PROPERTY_SUPPORTED_CHANNELS={axis:{x:!0,y:!0,row:!0,column:!0},legend:{color:!0,opacity:!0,size:!0,shape:!0},scale:{x:!0,y:!0,color:!0,opacity:!0,row:!0,column:!0,size:!0,shape:!0},sort:{x:!0,y:!0,path:!0,order:!0},stack:{x:!0,y:!0}},n.spec=d,n.encoding=f,n.fieldDef=p,n.parse=function(e){let t=e.split("|"),n={mark:t[0],encodings:[]};for(let e=1;e<t.length;e++){const r=g(t[e],":",1),i=r[0],o=r[1];if(Cn.isChannel(i)||"?"===i){const e=y.encoding(i,o);n.encodings.push(e)}else"transform"!==i||(n.transform=JSON.parse(o))}return n},n.splitWithTail=g,function(e){function t(e){const t={};t.field=e[0],t.type=s.getFullName(e[1].toUpperCase())||"?";let r=e[2],i=0,o=0;for(;o<r.length;){let e,a=r.indexOf("=",o);if(-1===a)break;{let s=r.substring(o,a);if("{"===r[o+s.length+1]){let t=o+s.length+1;i=n(t,r,"}");const a=r.substring(t,i+1);e=JSON.parse(a),o=i+2}else if("["===r[o+s.length+1]){let t=o+s.length+1,i=n(t,r,"]");const a=r.substring(t,i+1);e=JSON.parse(a),o=i+2}else{let t=o,n=r.indexOf(",",o+s.length);-1===n&&(n=r.length),o=n+1,e=JSON.parse(r.substring(t+s.length+1,n))}Jt.isEncodingNestedParent(s)?t[s]=e:(t.bin=t.bin||{},t.bin[s]=e)}}return t}function n(e,t,n){for(let r=e;r<t.length;r++)if(t[r]===n)return r}function r(e){const r={};if("?"===e[0]){let i=n(1,e,"}"),o=JSON.parse(e.substring(1,i+1));for(let e in o)zt.isArray(o[e])?r[e]={enum:o[e]}:r[e]=o[e];return Object.assign(Object.assign({},r),t(g(e.substring(i+2,e.length-1),",",2)))}{let n=e.substring(0,e.indexOf("(")),r=g(e.substring(n.length+1,e.length-1),",",2);if(Ei.isAggregateOp(n))return Object.assign({aggregate:n},t(r));if(Oi.isUTCTimeUnit(n)||Oi.isLocalSingleTimeUnit(n))return Object.assign({timeUnit:n},t(r));if("bin"===n)return Object.assign({bin:{}},t(r))}}e.encoding=function(e,n){let i=-1!==n.indexOf("(")?r(n):t(g(n,",",2));return Object.assign({channel:e},i)},e.rawFieldDef=t,e.getClosingIndex=n,e.fn=r}(y=n.shorthandParser||(n.shorthandParser={}))})),vi=r(ai),bi=r(si),Pi=n((function(t,n){var r=e&&e.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.scaleType=n.isDimension=n.isMeasure=n.isContinuous=n.toFieldDef=n.toValueDef=n.toEncoding=n.isEnabledAutoCountQuery=n.isDisabledAutoCountQuery=n.isAutoCountQuery=n.isFieldQuery=n.isValueQuery=void 0;const a=o(vi),s=o(Dn);function c(e){return null!=e&&void 0!==e.value}function u(e){return null!=e&&(e.field||"count"===e.aggregate)}function l(e){return null!=e&&"autoCount"in e}function d(e){return l(e)&&!1===e.autoCount}n.isValueQuery=c,n.isFieldQuery=u,n.isAutoCountQuery=l,n.isDisabledAutoCountQuery=d,n.isEnabledAutoCountQuery=function(e){return l(e)&&!0===e.autoCount};const f=[Jt.Property.AGGREGATE,Jt.Property.BIN,Jt.Property.TIMEUNIT,Jt.Property.FIELD,Jt.Property.TYPE,Jt.Property.SCALE,Jt.Property.SORT,Jt.Property.AXIS,Jt.Property.LEGEND,Jt.Property.STACK,Jt.Property.FORMAT];function p(e){const{value:t}=e;return Mn.isWildcard(t)?null:{value:t}}function g(e,t={}){const{props:n=f,schema:r,wildcardMode:i="skip"}=t;if(u(e)){const t={};for(const o of n){let n=e[o];if(Mn.isWildcard(n)){if("skip"===i)continue;return null}if(void 0!==n){if(!(!Ti.PROPERTY_SUPPORTED_CHANNELS[o]||Ti.PROPERTY_SUPPORTED_CHANNELS[o][e.channel]))continue;if(Jt.isEncodingNestedParent(o)&&qt.isObject(n)){n=Object.assign({},n);for(const e in n)if(Mn.isWildcard(n[e])){if("null"===i)return null;delete n[e]}}if("bin"===o&&!1===n)continue;"type"===o&&"key"===n?t.type="nominal":t[o]=n}if(o===Jt.Property.SCALE&&r&&e.type===s.ORDINAL){const n=e.scale,{ordinalDomain:i}=r.fieldSchema(e.field);null!==n&&i&&(t[Jt.Property.SCALE]=Object.assign({domain:i},qt.isObject(n)?n:{}))}}return t}if(!1===e.autoCount)throw new Error("Cannot convert {autoCount: false} into a field def");return{aggregate:"count",field:"*",type:"quantitative"}}function y(e){if(u(e)){const t=g(e,{props:e.field?["field","bin","timeUnit","type"]:["bin","timeUnit","type"]});return a.isDiscrete(t)||!!t.timeUnit}return!1}n.toEncoding=function(e,t){let n={};for(const r of e){if(d(r))continue;const{channel:e}=r;if(Mn.isWildcard(e))throw new Error("Cannot convert wildcard channel to a fixed channel");const i=c(r)?p(r):g(r,t);if(null!==i)n[e]=i;else if("null"===t.wildcardMode)return null}return n},n.toValueDef=p,n.toFieldDef=g,n.isContinuous=function(e){return u(e)?a.isContinuous(g(e,{props:["bin","timeUnit","field","type"]})):l(e)},n.isMeasure=function(e){return u(e)?!y(e)&&"temporal"!==e.type:l(e)},n.isDimension=y,n.scaleType=function(e){const t=!0===e.scale||e.scale===Mn.SHORT_WILDCARD?{}:e.scale||{},{type:n,channel:r,timeUnit:i,bin:o}=e;if(Mn.isWildcard(t.type)||Mn.isWildcard(n)||Mn.isWildcard(r)||Mn.isWildcard(o))return;if("row"===r||"column"===r||"facet"===r)return;if(t.type)return t.type;if("temporal"===n&&Mn.isWildcard(i))return;if("quantitative"===n&&Mn.isWildcard(o))return;const a={type:n===ci.ExpandedType.KEY?"nominal":n,timeUnit:i,bin:o};return bi.scaleType({type:t.type},r,a,undefined)}})),_i=n((function(e,t){!function(e){var t=new Date,n=new Date;function r(e,i,o,a){function s(t){return e(t=new Date(+t)),t}return s.floor=s,s.round=function(t){var n=new Date(+t),r=new Date(t-1);return e(n),e(r),i(r,1),t-n<r-t?n:r},s.ceil=function(t){return e(t=new Date(t-1)),i(t,1),t},s.offset=function(e,t){return i(e=new Date(+e),null==t?1:Math.floor(t)),e},s.range=function(t,n,r){var o=[];if(t=new Date(t-1),n=new Date(+n),r=null==r?1:Math.floor(r),!(t<n&&r>0))return o;for(i(t,1),e(t),t<n&&o.push(new Date(+t));i(t,r),e(t),t<n;)o.push(new Date(+t));return o},s.filter=function(t){return r((function(n){for(;e(n),!t(n);)n.setTime(n-1)}),(function(e,n){for(;--n>=0;)for(;i(e,1),!t(e););}))},o&&(s.count=function(r,i){return t.setTime(+r),n.setTime(+i),e(t),e(n),Math.floor(o(t,n))},s.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?s.filter(a?function(t){return a(t)%e==0}:function(t){return s.count(0,t)%e==0}):s:null}),s}var i=r((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?r((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):i:null};var o=r((function(e){e.setMilliseconds(0)}),(function(e,t){e.setTime(+e+1e3*t)}),(function(e,t){return(t-e)/1e3}),(function(e){return e.getSeconds()})),a=r((function(e){e.setSeconds(0,0)}),(function(e,t){e.setTime(+e+6e4*t)}),(function(e,t){return(t-e)/6e4}),(function(e){return e.getMinutes()})),s=r((function(e){e.setMinutes(0,0,0)}),(function(e,t){e.setTime(+e+36e5*t)}),(function(e,t){return(t-e)/36e5}),(function(e){return e.getHours()})),c=r((function(e){e.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+t)}),(function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5}),(function(e){return e.getDate()-1}));function u(e){return r((function(t){t.setHours(0,0,0,0),t.setDate(t.getDate()-(t.getDay()+7-e)%7)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/6048e5}))}var l=u(0),d=u(1),f=u(2),p=u(3),g=u(4),y=u(5),h=u(6),m=r((function(e){e.setHours(0,0,0,0),e.setDate(1)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()})),E=r((function(e){e.setHours(0,0,0,0),e.setMonth(0,1)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()})),O=r((function(e){e.setUTCMilliseconds(0)}),(function(e,t){e.setTime(+e+1e3*t)}),(function(e,t){return(t-e)/1e3}),(function(e){return e.getUTCSeconds()})),T=r((function(e){e.setUTCSeconds(0,0)}),(function(e,t){e.setTime(+e+6e4*t)}),(function(e,t){return(t-e)/6e4}),(function(e){return e.getUTCMinutes()})),v=r((function(e){e.setUTCMinutes(0,0,0)}),(function(e,t){e.setTime(+e+36e5*t)}),(function(e,t){return(t-e)/36e5}),(function(e){return e.getUTCHours()})),b=r((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/864e5}),(function(e){return e.getUTCDate()-1}));function P(e){return r((function(t){t.setUTCHours(0,0,0,0),t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/6048e5}))}var _=P(0),S=P(1),A=P(2),N=P(3),C=P(4),I=P(5),D=P(6),M=r((function(e){e.setUTCHours(0,0,0,0),e.setUTCDate(1)}),(function(e,t){e.setUTCMonth(e.getUTCMonth()+t)}),(function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())}),(function(e){return e.getUTCMonth()})),R=r((function(e){e.setUTCHours(0,0,0,0),e.setUTCMonth(0,1)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()})),w=i.range,U=o.range,F=a.range,x=s.range,L=c.range,k=l.range,j=d.range,B=f.range,W=p.range,Y=g.range,G=y.range,Q=h.range,$=l.range,H=m.range,q=E.range,z=i,V=w,K=O.range,X=T.range,J=v.range,Z=b.range,ee=_.range,te=S.range,ne=A.range,re=N.range,ie=C.range,oe=I.range,ae=D.range,se=_.range,ce=M.range,ue=R.range,le="0.1.1";e.version=le,e.milliseconds=w,e.seconds=U,e.minutes=F,e.hours=x,e.days=L,e.sundays=k,e.mondays=j,e.tuesdays=B,e.wednesdays=W,e.thursdays=Y,e.fridays=G,e.saturdays=Q,e.weeks=$,e.months=H,e.years=q,e.utcMillisecond=z,e.utcMilliseconds=V,e.utcSeconds=K,e.utcMinutes=X,e.utcHours=J,e.utcDays=Z,e.utcSundays=ee,e.utcMondays=te,e.utcTuesdays=ne,e.utcWednesdays=re,e.utcThursdays=ie,e.utcFridays=oe,e.utcSaturdays=ae,e.utcWeeks=se,e.utcMonths=ce,e.utcYears=ue,e.millisecond=i,e.second=o,e.minute=a,e.hour=s,e.day=c,e.sunday=l,e.monday=d,e.tuesday=f,e.wednesday=p,e.thursday=g,e.friday=y,e.saturday=h,e.week=l,e.month=m,e.year=E,e.utcSecond=O,e.utcMinute=T,e.utcHour=v,e.utcDay=b,e.utcSunday=_,e.utcMonday=S,e.utcTuesday=A,e.utcWednesday=N,e.utcThursday=C,e.utcFriday=I,e.utcSaturday=D,e.utcWeek=_,e.utcMonth=M,e.utcYear=R,e.interval=r}(t)})),Si=new Date,Ai=new Date(2e3,0,1),Ni=new Date(Date.UTC(2e3,0,1));function Ci(e){return Si.setTime(+e),Si}function Ii(e,t,n,r,i,o){var a={type:e,date:t,unit:n};return r?a.step=r:a.minstep=1,null!=i&&(a.min=i),null!=o&&(a.max=o),a}function Di(e,t,n,r,i,o){return Ii(e,(function(e){return t.offset(n,e)}),(function(e){return t.count(n,e)}),r,i,o)}var Mi=[Di("second",_i.second,Ai),Di("minute",_i.minute,Ai),Di("hour",_i.hour,Ai),Di("day",_i.day,Ai,[1,7]),Di("month",_i.month,Ai,[1,3,6]),Di("year",_i.year,new Date(Ai).setFullYear(0)),Ii("seconds",(function(e){return new Date(1970,0,1,0,0,e)}),(function(e){return Ci(e).getSeconds()}),null,0,59),Ii("minutes",(function(e){return new Date(1970,0,1,0,e)}),(function(e){return Ci(e).getMinutes()}),null,0,59),Ii("hours",(function(e){return new Date(1970,0,1,e)}),(function(e){return Ci(e).getHours()}),null,0,23),Ii("weekdays",(function(e){return new Date(1970,0,4+e)}),(function(e){return Ci(e).getDay()}),[1],0,6),Ii("dates",(function(e){return new Date(1970,0,e)}),(function(e){return Ci(e).getDate()}),[1],1,31),Ii("months",(function(e){return new Date(1970,e%12,1)}),(function(e){return Ci(e).getMonth()}),[1],0,11)],Ri=[Di("second",_i.utcSecond,Ni),Di("minute",_i.utcMinute,Ni),Di("hour",_i.utcHour,Ni),Di("day",_i.utcDay,Ni,[1,7]),Di("month",_i.utcMonth,Ni,[1,3,6]),Di("year",_i.utcYear,new Date(Ni).setUTCFullYear(0)),Ii("seconds",(function(e){return new Date(Date.UTC(1970,0,1,0,0,e))}),(function(e){return Ci(e).getUTCSeconds()}),null,0,59),Ii("minutes",(function(e){return new Date(Date.UTC(1970,0,1,0,e))}),(function(e){return Ci(e).getUTCMinutes()}),null,0,59),Ii("hours",(function(e){return new Date(Date.UTC(1970,0,1,e))}),(function(e){return Ci(e).getUTCHours()}),null,0,23),Ii("weekdays",(function(e){return new Date(Date.UTC(1970,0,4+e))}),(function(e){return Ci(e).getUTCDay()}),[1],0,6),Ii("dates",(function(e){return new Date(Date.UTC(1970,0,e))}),(function(e){return Ci(e).getUTCDate()}),[1],1,31),Ii("months",(function(e){return new Date(Date.UTC(1970,e%12,1))}),(function(e){return Ci(e).getUTCMonth()}),[1],0,11)],wi=[[31536e6,5],[7776e6,4],[2592e6,4],[12096e5,3],[6048e5,3],[1728e5,3],[864e5,3],[432e5,2],[216e5,2],[108e5,2],[36e5,2],[18e5,1],[9e5,1],[3e5,1],[6e4,1],[3e4,0],[15e3,0],[5e3,0],[1e3,0]];function Ui(e){var t,n,r={};for(t=0,n=e.length;t<n;++t)r[e[t].type]=e[t];return r.find=function(t,n,r){return function(e,t,n,r){var i,o,a,s=wi[0];for(i=1,o=wi.length;i<o;++i)if(t>(s=wi[i])[0]){if((a=t/s[0])>r)return e[wi[i-1][1]];if(a>=n)return e[s[1]]}return e[wi[o-1][1]]}(e,t,n,r)},r}var Fi=Ui(Mi),xi=Ui(Ri);Fi.utc=xi;function Li(e){if(!e)throw Error("Missing binning options.");var t,n,r,i,o,a,s,c=e.maxbins||15,u=e.base||10,l=Math.log(u),d=e.div||[5,2],f=e.min,p=e.max,g=p-f;if(e.step)t=e.step;else if(e.steps)t=e.steps[Math.min(e.steps.length-1,function(e,t,n,r){for(;n<r;){var i=n+r>>>1;qt.cmp(e[i],t)<0?n=i+1:r=i}return n}(e.steps,g/c,0,e.steps.length))];else{for(n=Math.ceil(Math.log(c)/l),r=e.minstep||0,t=Math.max(r,Math.pow(u,Math.round(Math.log(g)/l)-n));Math.ceil(g/t)>c;)t*=u;for(a=0;a<d.length;++a)(o=t/d[a])>=r&&g/o<=c&&(t=o)}return i=(o=Math.log(t))>=0?0:1+~~(-o/l),s=Math.pow(u,-i-1),{start:f=Math.min(f,Math.floor(f/t+s)*t),stop:p=Math.ceil(p/t)*t,step:t,unit:{precision:i},value:ki,index:ji}}function ki(e){return this.start+this.step*Math.floor((e-this.start+1e-14)/this.step)}function ji(e){return Math.floor((e-this.start)/this.step+1e-14)}function Bi(e){return this.unit.date(ki.call(this,e))}function Wi(e){return ji.call(this,this.unit.unit(e))}Li.date=function(e){if(!e)throw Error("Missing date binning options.");var t=e.utc?Fi.utc:Fi,n=e.min,r=e.max,i=e.maxbins||20,o=e.minbins||4,a=+r-+n,s=e.unit?t[e.unit]:t.find(a,o,i),c=Li({min:null!=s.min?s.min:s.unit(n),max:null!=s.max?s.max:s.unit(r),maxbins:i,minstep:s.minstep,steps:s.step});return c.unit=s,c.index=Wi,e.raw||(c.value=Bi),c};var Yi=Li,Gi="__types__",Qi={boolean:qt.boolean,integer:qt.number,number:qt.number,date:qt.date,string:function(e){return null==e||""===e?null:e+""}},$i={boolean:function(e){return"true"===e||"false"===e||qt.isBoolean(e)},integer:function(e){return $i.number(e)&&(e=+e)==~~e},number:function(e){return!isNaN(+e)&&!qt.isDate(e)},date:function(e){return!isNaN(Date.parse(e))}};function Hi(e){return qt.keys(e)}function qi(e){return"["+e+"]"}function zi(e,t){var n,r,i;if(e=qt.array(e),t=qt.$(t),e[Gi]&&(n=t(e[Gi]),qt.isString(n)))return n;for(r=0,i=e.length;!qt.isValid(n)&&r<i;++r)n=t?t(e[r]):e[r];return qt.isDate(n)?"date":qt.isNumber(n)?"number":qt.isBoolean(n)?"boolean":qt.isString(n)?"string":null}function Vi(e,t,n){var r,i,o;e=qt.array(e),t=qt.$(t);var a=["boolean","integer","number","date"];for(r=0;r<e.length;++r){for(o=t?t(e[r]):e[r],i=0;i<a.length;++i)n&&n.test(o)||!qt.isValid(o)||$i[a[i]](o)||(a.splice(i,1),i-=1);if(0===a.length)return"string"}return a[0]}zi.annotation=function(e,t){if(!t)return e&&e[Gi]||null;e[Gi]=t},zi.all=function(e,t){if(e.length){var n=t?qt.identity:(t=Hi(e[0]),qi);return t.reduce((function(t,r){return t[r]=zi(e,n(r)),t}),{})}},zi.infer=Vi,zi.inferAll=function(e,t,n){var r=t?qt.identity:(t=Hi(e[0]),qi);return t.reduce((function(t,i){return t[i]=Vi(e,r(i),n),t}),{})},zi.parsers=Qi;var Ki=zi,Xi=n((function(e){var t=e.exports;t.repeat=function(e,t){var n,r=Array(t);for(n=0;n<t;++n)r[n]=e;return r},t.zeros=function(e){return t.repeat(0,e)},t.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),(t-e)/n==1/0)throw new Error("Infinite range");var r,i=[],o=-1;if(n<0)for(;(r=e+n*++o)>t;)i.push(r);else for(;(r=e+n*++o)<t;)i.push(r);return i},t.random={},t.random.uniform=function(e,n){void 0===n&&(n=void 0===e?1:e,e=0);var r=n-e,i=function(){return e+r*Math.random()};return i.samples=function(e){return t.zeros(e).map(i)},i.pdf=function(t){return t>=e&&t<=n?1/r:0},i.cdf=function(t){return t<e?0:t>n?1:(t-e)/r},i.icdf=function(t){return t>=0&&t<=1?e+t*r:NaN},i},t.random.integer=function(e,n){void 0===n&&(n=e,e=0);var r=n-e,i=function(){return e+Math.floor(r*Math.random())};return i.samples=function(e){return t.zeros(e).map(i)},i.pdf=function(t){return t===Math.floor(t)&&t>=e&&t<n?1/r:0},i.cdf=function(t){var i=Math.floor(t);return i<e?0:i>=n?1:(i-e+1)/r},i.icdf=function(t){return t>=0&&t<=1?e-1+Math.floor(t*r):NaN},i},t.random.normal=function(e,n){var r;e=e||0,n=n||1;var i=function(){var t,i,o=0,a=0;if(void 0!==r)return o=r,r=void 0,o;do{t=(o=2*Math.random()-1)*o+(a=2*Math.random()-1)*a}while(0===t||t>1);return i=Math.sqrt(-2*Math.log(t)/t),r=e+a*i*n,e+o*i*n};return i.samples=function(e){return t.zeros(e).map(i)},i.pdf=function(t){var r=Math.exp(Math.pow(t-e,2)/(-2*Math.pow(n,2)));return 1/(n*Math.sqrt(2*Math.PI))*r},i.cdf=function(t){var r,i=(t-e)/n,o=Math.abs(i);if(o>37)r=0;else{var a=Math.exp(-o*o/2);o<7.07106781186547?(r=a*((((((.0352624965998911*o+.700383064443688)*o+6.37396220353165)*o+33.912866078383)*o+112.079291497871)*o+221.213596169931)*o+220.206867912376),r/=((((((.0883883476483184*o+1.75566716318264)*o+16.064177579207)*o+86.7807322029461)*o+296.564248779674)*o+637.333633378831)*o+793.826512519948)*o+440.413735824752):r=a/(o+1/(o+2/(o+3/(o+4/(o+.65)))))/2.506628274631}return i>0?1-r:r},i.icdf=function(t){if(t<=0||t>=1)return NaN;var r=2*t-1,i=8*(Math.PI-3)/(3*Math.PI*(4-Math.PI)),o=2/(Math.PI*i)+Math.log(1-Math.pow(r,2))/2,a=Math.log(1-r*r)/i,s=(r>0?1:-1)*Math.sqrt(Math.sqrt(o*o-a)-o);return e+n*Math.SQRT2*s},i},t.random.bootstrap=function(e,n){var r=e.filter(qt.isValid),i=r.length,o=n?t.random.normal(0,n):null,a=function(){return r[~~(Math.random()*i)]+(o?o():0)};return a.samples=function(e){return t.zeros(e).map(a)},a}})),Ji=n((function(e){var t=e.exports;function n(e,n,r){var i=e&&e.nullh||0,o=Xi.random.normal(0,1),a=t.mean(n,r),s=t.stdev(n,r)/Math.sqrt(t.count.valid(n,r));if(0===s)return a-i==0?1:0;var c=(a-i)/s;return 2*o.cdf(-Math.abs(c))}function r(e,n,r,i){var o,a=i?n.map(qt.$(r)):n,s=i?n.map(qt.$(i)):r,c=t.count(a),u=t.count(s),l=Array();if(c!==u)throw Error("Array lengths must match.");for(o=0;o<c;++o)qt.isValid(a[o])&&qt.isValid(s[o])&&l.push(a[o]-s[o]);return t.z.test(l,e&&e.nullh||0)}function i(e,n,r,i){var o=i?n.map(qt.$(r)):n,a=i?n.map(qt.$(i)):r,s=t.count.valid(o),c=t.count.valid(a),u=Xi.random.normal(0,1),l=t.mean(o)-t.mean(a)-(e&&e.nullh||0),d=Math.sqrt(t.variance(o)/s+t.variance(a)/c);if(0===d)return 0===l?1:0;var f=l/d;return 2*u.cdf(-Math.abs(f))}t.unique=function(e,t,n){t=qt.$(t),n=n||[];var r,i,o,a={};for(i=0,o=e.length;i<o;++i)(r=t?t(e[i]):e[i])in a||(a[r]=1,n.push(r));return n},t.count=function(e){return e&&e.length||0},t.count.valid=function(e,t){t=qt.$(t);var n,r,i,o=0;for(r=0,i=e.length;r<i;++r)n=t?t(e[r]):e[r],qt.isValid(n)&&(o+=1);return o},t.count.missing=function(e,t){t=qt.$(t);var n,r,i=0;for(n=0,r=e.length;n<r;++n)null==(t?t(e[n]):e[n])&&(i+=1);return i},t.count.distinct=function(e,t){t=qt.$(t);var n,r,i,o={},a=0;for(r=0,i=e.length;r<i;++r)(n=t?t(e[r]):e[r])in o||(o[n]=1,a+=1);return a},t.count.map=function(e,t){t=qt.$(t);var n,r,i,o={};for(r=0,i=e.length;r<i;++r)o[n=t?t(e[r]):e[r]]=n in o?o[n]+1:1;return o},t.median=function(e,n){return n&&(e=e.map(qt.$(n))),e=e.filter(qt.isValid).sort(qt.cmp),t.quantile(e,.5)},t.quartile=function(e,n){n&&(e=e.map(qt.$(n))),e=e.filter(qt.isValid).sort(qt.cmp);var r=t.quantile;return[r(e,.25),r(e,.5),r(e,.75)]},t.quantile=function(e,t,n){void 0===n&&(n=t,t=qt.identity),t=qt.$(t);var r=(e.length-1)*n+1,i=Math.floor(r),o=+t(e[i-1]),a=r-i;return a?o+a*(t(e[i])-o):o},t.sum=function(e,t){t=qt.$(t);for(var n,r=0,i=0,o=e.length;i<o;++i)n=t?t(e[i]):e[i],qt.isValid(n)&&(r+=n);return r},t.mean=function(e,t){t=qt.$(t);var n,r,i,o,a=0;for(n=0,i=0,r=e.length;n<r;++n)o=t?t(e[n]):e[n],qt.isValid(o)&&(a+=(o-a)/++i);return a},t.mean.geometric=function(e,t){t=qt.$(t);var n,r,i,o,a=1;for(o=0,n=0,r=e.length;o<r;++o)if(i=t?t(e[o]):e[o],qt.isValid(i)){if(i<=0)throw Error("Geometric mean only defined for positive values.");a*=i,++n}return a=n>0?Math.pow(a,1/n):0},t.mean.harmonic=function(e,t){t=qt.$(t);var n,r,i,o,a=0;for(o=0,n=0,r=e.length;o<r;++o)i=t?t(e[o]):e[o],qt.isValid(i)&&(a+=1/i,++n);return n/a},t.variance=function(e,t){if(t=qt.$(t),!qt.isArray(e)||e.length<2)return 0;var n,r,i,o,a=0,s=0;for(r=0,i=0;r<e.length;++r)o=t?t(e[r]):e[r],qt.isValid(o)&&(s+=(n=o-a)*(o-(a+=n/++i)));return s/=i-1},t.stdev=function(e,n){return Math.sqrt(t.variance(e,n))},t.modeskew=function(e,n){var r=t.mean(e,n),i=t.median(e,n),o=t.stdev(e,n);return 0===o?0:(r-i)/o},t.min=function(e,n){return t.extent(e,n)[0]},t.max=function(e,n){return t.extent(e,n)[1]},t.extent=function(e,t){t=qt.$(t);var n,r,i,o,a=e.length;for(o=0;o<a;++o)if(i=t?t(e[o]):e[o],qt.isValid(i)){n=r=i;break}for(;o<a;++o)i=t?t(e[o]):e[o],qt.isValid(i)&&(i<n&&(n=i),i>r&&(r=i));return[n,r]},t.extent.index=function(e,t){t=qt.$(t);var n,r,i,o,a=-1,s=-1,c=e.length;for(o=0;o<c;++o)if(i=t?t(e[o]):e[o],qt.isValid(i)){n=r=i,a=s=o;break}for(;o<c;++o)i=t?t(e[o]):e[o],qt.isValid(i)&&(i<n&&(n=i,a=o),i>r&&(r=i,s=o));return[a,s]},t.dot=function(e,t,n){var r,i,o=0;if(n)for(t=qt.$(t),n=qt.$(n),r=0;r<e.length;++r)(i=t(e[r])*n(e[r]))==i&&(o+=i);else{if(e.length!==t.length)throw Error("Array lengths must match.");for(r=0;r<e.length;++r)(i=e[r]*t[r])==i&&(o+=i)}return o},t.dist=function(e,t,n,r){var i,o,a=qt.isFunction(n)||qt.isString(n),s=e,c=a?e:t,u=a?r:n,l=2===u||null==u,d=e.length,f=0;for(a&&(t=qt.$(t),n=qt.$(n)),o=0;o<d;++o)i=a?t(s[o])-n(c[o]):s[o]-c[o],f+=l?i*i:Math.pow(Math.abs(i),u);return l?Math.sqrt(f):Math.pow(f,1/u)},t.cohensd=function(e,n,r){var i=r?e.map(qt.$(n)):e,o=r?e.map(qt.$(r)):n,a=t.mean(i),s=t.mean(o),c=t.count.valid(i),u=t.count.valid(o);if(c+u-2<=0)return 0;var l=t.variance(i),d=t.variance(o),f=Math.sqrt(((c-1)*l+(u-1)*d)/(c+u-2));return 0===f?0:(a-s)/f},t.covariance=function(e,n,r){var i,o,a,s,c,u=r?e.map(qt.$(n)):e,l=r?e.map(qt.$(r)):n,d=u.length,f=t.mean(u),p=t.mean(l),g=0,y=0;if(d!==l.length)throw Error("Input lengths must match.");for(i=0;i<d;++i)if(o=u[i],s=qt.isValid(o),a=l[i],c=qt.isValid(a),s&&c)g+=(o-f)*(a-p),++y;else if(s||c)throw Error("Valid values must align.");return g/(y-1)},t.rank=function(e,t){t=qt.$(t)||qt.identity;var n,r,i,o=e.map((function(e,n){return{idx:n,val:t(e)}})).sort(qt.comparator("val")),a=e.length,s=Array(a),c=-1,u={};for(n=0;n<a;++n){if(r=o[n].val,c<0&&u===r)c=n-1;else if(c>-1&&u!==r){for(i=1+(n-1+c)/2;c<n;++c)s[o[c].idx]=i;c=-1}s[o[n].idx]=n+1,u=r}if(c>-1)for(i=1+(a-1+c)/2;c<a;++c)s[o[c].idx]=i;return s},t.cor=function(e,n,r){var i=r;r=i?e.map(qt.$(r)):n,n=i?e.map(qt.$(n)):e;var o=t.dot(n,r),a=t.mean(n),s=t.mean(r),c=t.stdev(n),u=t.stdev(r),l=e.length;return(o-l*a*s)/((l-1)*c*u)},t.cor.rank=function(e,n,r){var i,o,a,s=r?t.rank(e,n):t.rank(e),c=r?t.rank(e,r):t.rank(n),u=e.length;for(i=0,o=0;i<u;++i)o+=(a=s[i]-c[i])*a;return 1-6*o/(u*(u*u-1))},t.cor.dist=function(e,n,r){var i,o,a,s,c=r?e.map(qt.$(n)):e,u=r?e.map(qt.$(r)):n,l=t.dist.mat(c),d=t.dist.mat(u),f=l.length;for(i=0,o=0,a=0,s=0;i<f;++i)o+=l[i]*l[i],a+=d[i]*d[i],s+=l[i]*d[i];return Math.sqrt(s/Math.sqrt(o*a))},t.linearRegression=function(e,n,r){var i,o,a=r?e.map(qt.$(n)):e,s=r?e.map(qt.$(r)):n,c=a.length,u=t.covariance(a,s),l=t.stdev(a),d=t.stdev(s),f=u/(l*l),p=t.mean(s)-f*t.mean(a),g={slope:f,intercept:p,R:u/(l*d),rss:0};for(o=0;o<c;++o)qt.isValid(a[o])&&qt.isValid(s[o])&&(i=f*a[o]+p-s[o],g.rss+=i*i);return g},t.bootstrap={},t.bootstrap.ci=function(e,n,r,i,o){var a,s,c,u,l,d,f;for(qt.isFunction(n)||qt.isString(n)?(a=e.map(qt.$(n)),s=r,c=i,u=o):(a=e,s=n,c=r,u=i),s=s?+s:1e3,c=c||.05,l=Xi.random.bootstrap(a,u),f=0,d=Array(s);f<s;++f)d[f]=t.mean(l.samples(a.length));return d.sort(qt.numcmp),[t.quantile(d,c/2),t.quantile(d,1-c/2)]},t.z={},t.z.ci=function(e,n,r){var i=e,o=n;(qt.isFunction(n)||qt.isString(n))&&(i=e.map(qt.$(n)),o=r);var a=.05===(o=o||.05)?1.96:Xi.random.normal(0,1).icdf(1-o/2),s=t.mean(i),c=t.stdev(i)/Math.sqrt(t.count.valid(i));return[s-a*c,s+a*c]},t.z.test=function(e,t,o,a){return qt.isFunction(o)||qt.isString(o)?(a&&a.paired?r:i)(a,e,t,o):qt.isArray(t)?(o&&o.paired?r:i)(o,e,t):qt.isFunction(t)||qt.isString(t)?n(o,e,t):n(t,e)},t.dist.mat=function(e){var t,n,r,i=e.length,o=i*i,a=Array(o),s=Xi.zeros(i),c=0;for(n=0;n<i;++n)for(a[n*i+n]=0,r=n+1;r<i;++r)a[n*i+r]=t=Math.abs(e[n]-e[r]),a[r*i+n]=t,s[n]+=t,s[r]+=t;for(n=0;n<i;++n)c+=s[n],s[n]/=i;for(c/=o,n=0;n<i;++n)for(r=n;r<i;++r)a[n*i+r]+=c-s[n]-s[r],a[r*i+n]=a[n*i+r];return a},t.entropy=function(e,t){t=qt.$(t);var n,r,i=0,o=0,a=e.length;for(n=0;n<a;++n)i+=t?t(e[n]):e[n];if(0===i)return 0;for(n=0;n<a;++n)(r=(t?t(e[n]):e[n])/i)&&(o+=r*Math.log(r));return-o/Math.LN2},t.mutual=function(e,t,n,r){var i,o,a,s=r?e.map(qt.$(t)):e,c=r?e.map(qt.$(n)):t,u=r?e.map(qt.$(r)):n,l={},d={},f=u.length,p=0,g=0,y=0;for(a=0;a<f;++a)l[s[a]]=0,d[c[a]]=0;for(a=0;a<f;++a)l[s[a]]+=u[a],d[c[a]]+=u[a],p+=u[a];for(o=1/(p*Math.LN2),a=0;a<f;++a)0!==u[a]&&(i=p*u[a]/(l[s[a]]*d[c[a]]),g+=u[a]*o*Math.log(i),y+=u[a]*o*Math.log(u[a]/p));return[g,1+g/y]},t.mutual.info=function(e,n,r,i){return t.mutual(e,n,r,i)[0]},t.mutual.dist=function(e,n,r,i){return t.mutual(e,n,r,i)[1]},t.profile=function(e,n){var r,i,o,a,s,c=0,u=0,l=0,d=0,f=null,p=null,g=0,y=[],h={};for(o=0;o<e.length;++o)h[a=n?n(e[o]):e[o]]=a in h?h[a]+1:(d+=1,1),null==a?++l:qt.isValid(a)&&(s="string"==typeof a?a.length:a,(null===f||s<f)&&(f=s),(null===p||s>p)&&(p=s),g+=(r=s-c)*(s-(c+=r/++u)),y.push(s));return g/=u-1,i=Math.sqrt(g),y.sort(qt.cmp),{type:Ki(e,n),unique:h,count:e.length,valid:u,missing:l,distinct:d,min:f,max:p,mean:c,stdev:i,median:a=t.quantile(y,.5),q1:t.quantile(y,.25),q3:t.quantile(y,.75),modeskew:0===i?0:(c-a)/i}},t.summary=function(e,n){var r=(n=n||qt.keys(e[0])).map((function(n){var r=t.profile(e,qt.$(n));return r.field=n,r}));return r.__summary__=!0,r}})),Zi=new Date,eo=new Date;function to(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},i.range=function(n,r,o){var a,s=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r&&o>0))return s;do{s.push(a=new Date(+n)),t(n,o),e(n)}while(a<n&&n<r);return s},i.filter=function(n){return to((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}))},n&&(i.count=function(t,r){return Zi.setTime(+t),eo.setTime(+r),e(Zi),e(eo),Math.floor(n(Zi,eo))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(t){return r(t)%e==0}:function(t){return i.count(0,t)%e==0}):i:null}),i}var no=to((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));no.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?to((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):no:null};var ro=1e3,io=6e4,oo=36e5,ao=864e5,so=6048e5,co=to((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+t*ro)}),(function(e,t){return(t-e)/ro}),(function(e){return e.getUTCSeconds()})),uo=to((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*ro)}),(function(e,t){e.setTime(+e+t*io)}),(function(e,t){return(t-e)/io}),(function(e){return e.getMinutes()})),lo=to((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*ro-e.getMinutes()*io)}),(function(e,t){e.setTime(+e+t*oo)}),(function(e,t){return(t-e)/oo}),(function(e){return e.getHours()})),fo=to((e=>e.setHours(0,0,0,0)),((e,t)=>e.setDate(e.getDate()+t)),((e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*io)/ao),(e=>e.getDate()-1));function po(e){return to((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*io)/so}))}var go=po(0),yo=(po(1),po(2),po(3),po(4),po(5),po(6),to((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()}))),ho=to((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()}));ho.every=function(e){return isFinite(e=Math.floor(e))&&e>0?to((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};var mo=to((function(e){e.setUTCSeconds(0,0)}),(function(e,t){e.setTime(+e+t*io)}),(function(e,t){return(t-e)/io}),(function(e){return e.getUTCMinutes()})),Eo=to((function(e){e.setUTCMinutes(0,0,0)}),(function(e,t){e.setTime(+e+t*oo)}),(function(e,t){return(t-e)/oo}),(function(e){return e.getUTCHours()})),Oo=to((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/ao}),(function(e){return e.getUTCDate()-1}));function To(e){return to((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/so}))}var vo=To(0),bo=(To(1),To(2),To(3),To(4),To(5),To(6),to((function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCMonth(e.getUTCMonth()+t)}),(function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())}),(function(e){return e.getUTCMonth()}))),Po=to((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()}));function _o(e){let t=e,n=e;function r(e,t,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){const o=r+i>>>1;n(e[o],t)<0?r=o+1:i=o}return r}return 1===e.length&&(t=(t,n)=>e(t)-n,n=function(e){return(t,n)=>{return(r=e(t))<(i=n)?-1:r>i?1:r>=i?0:NaN;var r,i}}(e)),{left:r,center:function(e,n,i,o){null==i&&(i=0),null==o&&(o=e.length);const a=r(e,n,i,o-1);return a>i&&t(e[a-1],n)>-t(e[a],n)?a-1:a},right:function(e,t,r,i){for(null==r&&(r=0),null==i&&(i=e.length);r<i;){const o=r+i>>>1;n(e[o],t)>0?i=o:r=o+1}return r}}}Po.every=function(e){return isFinite(e=Math.floor(e))&&e>0?to((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};var So=Math.sqrt(50),Ao=Math.sqrt(10),No=Math.sqrt(2);function Co(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=So?i*=10:o>=Ao?i*=5:o>=No&&(i*=2),t<e?-i:i}const Io="year",Do="quarter",Mo="month",Ro="week",wo="date",Uo="day",Fo="dayofyear",xo="hours",Lo="minutes",ko="seconds",jo="milliseconds",Bo=[Io,Do,Mo,Ro,wo,Uo,Fo,xo,Lo,ko,jo],Wo=Bo.reduce(((e,t,n)=>(e[t]=1+n,e)),{});function Yo(e){const t=E(e).slice(),n={};t.length||l("Missing time unit."),t.forEach((e=>{!function(e,t){return O.call(e,t)}(Wo,e)?l("Invalid time unit: ".concat(e,".")):n[e]=1}));return(n.week||n.day?1:0)+(n.quarter||n.month||n.date?1:0)+(n.dayofyear?1:0)>1&&l("Incompatible time units: ".concat(e)),t.sort(((e,t)=>Wo[e]-Wo[t])),t}const Go={[Io]:"%Y ",[Do]:"Q%q ",[Mo]:"%b ",[wo]:"%d ",[Ro]:"W%U ",[Uo]:"%a ",[Fo]:"%j ",[xo]:"%H:00",[Lo]:"00:%M",[ko]:":%S",[jo]:".%L",["".concat(Io,"-").concat(Mo)]:"%Y-%m ",["".concat(Io,"-").concat(Mo,"-").concat(wo)]:"%Y-%m-%d ",["".concat(xo,"-").concat(Lo)]:"%H:%M"};const Qo=new Date;function $o(e){return Qo.setFullYear(e),Qo.setMonth(0),Qo.setDate(1),Qo.setHours(0,0,0,0),Qo}function Ho(e){return fo.count($o(e.getFullYear())-1,e)}function qo(e){return go.count($o(e.getFullYear())-1,e)}function zo(e){return $o(e).getDay()}function Vo(e,t,n,r,i,o,a){if(0<=e&&e<100){const s=new Date(-1,t,n,r,i,o,a);return s.setFullYear(e),s}return new Date(e,t,n,r,i,o,a)}function Ko(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return Oo.count(t-1,e)}function Xo(e){const t=Date.UTC(e.getUTCFullYear(),0,1);return vo.count(t-1,e)}function Jo(e){return Qo.setTime(Date.UTC(e,0,1)),Qo.getUTCDay()}function Zo(e,t,n,r,i,o,a){if(0<=e&&e<100){const e=new Date(Date.UTC(-1,t,n,r,i,o,a));return e.setUTCFullYear(n.y),e}return new Date(Date.UTC(e,t,n,r,i,o,a))}function ea(e,t,n,r,i){const o=t||1,a=m(e),s=(e,t,i)=>function(e,t,n,r){const i=n<=1?e:r?(t,i)=>r+n*Math.floor((e(t,i)-r)/n):(t,r)=>n*Math.floor(e(t,r)/n);return t?(e,n)=>t(i(e,n),n):i}(n[i=i||e],r[i],e===a&&o,t),c=new Date,u=_(e),l=u.year?s(Io):function(e){return function(e){return"function"==typeof e}(e)?e:()=>e}(2012),d=u.month?s(Mo):u.quarter?s(Do):f,g=u.week&&u.day?s(Uo,1,Ro+Uo):u.week?s(Ro,1):u.day?s(Uo,1):u.date?s(wo,1):u.dayofyear?s(Fo,1):p,y=u.hours?s(xo):f,h=u.minutes?s(Lo):f,E=u.seconds?s(ko):f,O=u.milliseconds?s(jo):f;return function(e){c.setTime(+e);const t=l(c);return i(t,d(c),g(c,t),y(c),h(c),E(c),O(c))}}function ta(e,t,n){return t+7*e-(n+6)%7}const na={[Io]:e=>e.getFullYear(),[Do]:e=>Math.floor(e.getMonth()/3),[Mo]:e=>e.getMonth(),[wo]:e=>e.getDate(),[xo]:e=>e.getHours(),[Lo]:e=>e.getMinutes(),[ko]:e=>e.getSeconds(),[jo]:e=>e.getMilliseconds(),[Fo]:e=>Ho(e),[Ro]:e=>qo(e),[Ro+Uo]:(e,t)=>ta(qo(e),e.getDay(),zo(t)),[Uo]:(e,t)=>ta(1,e.getDay(),zo(t))},ra={[Do]:e=>3*e,[Ro]:(e,t)=>ta(e,0,zo(t))};const ia={[Io]:e=>e.getUTCFullYear(),[Do]:e=>Math.floor(e.getUTCMonth()/3),[Mo]:e=>e.getUTCMonth(),[wo]:e=>e.getUTCDate(),[xo]:e=>e.getUTCHours(),[Lo]:e=>e.getUTCMinutes(),[ko]:e=>e.getUTCSeconds(),[jo]:e=>e.getUTCMilliseconds(),[Fo]:e=>Ko(e),[Ro]:e=>Xo(e),[Uo]:(e,t)=>ta(1,e.getUTCDay(),Jo(t)),[Ro+Uo]:(e,t)=>ta(Xo(e),e.getUTCDay(),Jo(t))},oa={[Do]:e=>3*e,[Ro]:(e,t)=>ta(e,0,Jo(t))};const aa={[Io]:ho,[Do]:yo.every(3),[Mo]:yo,[Ro]:go,[wo]:fo,[Uo]:fo,[Fo]:fo,[xo]:lo,[Lo]:uo,[ko]:co,[jo]:no},sa={[Io]:Po,[Do]:bo.every(3),[Mo]:bo,[Ro]:vo,[wo]:Oo,[Uo]:Oo,[Fo]:Oo,[xo]:Eo,[Lo]:mo,[ko]:co,[jo]:no};function ca(e){return aa[e]}function ua(e){return sa[e]}function la(e,t,n){return e?e.offset(t,n):void 0}function da(e,t,n,r){return e?e.range(t,n,r):void 0}const fa=1e3,pa=6e4,ga=36e5,ya=864e5,ha=2592e6,ma=31536e6,Ea=[Io,Mo,wo,xo,Lo,ko,jo],Oa=Ea.slice(0,-1),Ta=Oa.slice(0,-1),va=Ta.slice(0,-1),ba=va.slice(0,-1),Pa=[Io,Mo],_a=[Io],Sa=[[Oa,1,fa],[Oa,5,5e3],[Oa,15,15e3],[Oa,30,3e4],[Ta,1,pa],[Ta,5,3e5],[Ta,15,9e5],[Ta,30,18e5],[va,1,ga],[va,3,108e5],[va,6,216e5],[va,12,432e5],[ba,1,ya],[[Io,Ro],1,6048e5],[Pa,1,ha],[Pa,3,7776e6],[_a,1,ma]];var Aa=Object.freeze({__proto__:null,DATE:wo,DAY:Uo,DAYOFYEAR:Fo,HOURS:xo,MILLISECONDS:jo,MINUTES:Lo,MONTH:Mo,QUARTER:Do,SECONDS:ko,TIME_UNITS:Bo,WEEK:Ro,YEAR:Io,dayofyear:function(e){return Ho(new Date(e))},timeBin:function(e){const t=e.extent,n=e.maxbins||40,r=Math.abs(function(e){return e&&m(e)-e[0]||0}(t))/n;let i,o,a=_o((e=>e[2])).right(Sa,r);return a===Sa.length?(i=_a,o=Co(t[0]/ma,t[1]/ma,n)):a?(a=Sa[r/Sa[a-1][2]<Sa[a][2]/r?a-1:a],i=a[0],o=a[1]):(i=Ea,o=Math.max(Co(t[0],t[1],n),1)),{units:i,step:o}},timeFloor:function(e,t){return ea(e,t||1,na,ra,Vo)},timeInterval:ca,timeOffset:function(e,t,n){return la(ca(e),t,n)},timeSequence:function(e,t,n,r){return da(ca(e),t,n,r)},timeUnitSpecifier:function(e,t){const n=function(e){for(let t,n,r=1,i=arguments.length;r<i;++r)for(n in t=arguments[r],t)e[n]=t[n];return e}({},Go,t),r=Yo(e),i=r.length;let o,a,s="",c=0;for(c=0;c<i;)for(o=r.length;o>c;--o)if(a=r.slice(c,o).join("-"),null!=n[a]){s+=n[a],c=o;break}return s.trim()},timeUnits:Yo,utcFloor:function(e,t){return ea(e,t||1,ia,oa,Zo)},utcInterval:ua,utcOffset:function(e,t,n){return la(ua(e),t,n)},utcSequence:function(e,t,n,r){return da(ua(e),t,n,r)},utcdayofyear:function(e){return Ko(new Date(e))},utcweek:function(e){return Xo(new Date(e))},week:function(e){return qo(new Date(e))}}),Na=r(Kn),Ca=r(Aa),Ia=n((function(t,n){var r=e&&e.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t},a=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.PrimitiveType=n.Schema=n.build=void 0;const s=a(Yi),c=o(Dn),u=o(Ca),l=s.default;n.build=function(e,t={},n={fields:[]}){t=zt.extend({},Rn.DEFAULT_QUERY_CONFIG,t);let r=Ji.summary(e),i=Ki.inferAll(e),o=n.fields.reduce(((e,t)=>(e[t.name]=t,e)),{}),a=r.map((function(n,r){const a=n.field,s="date"===i[a]?E.DATETIME:i[a];let u,l=n.distinct;if(s===E.NUMBER)u=c.QUANTITATIVE;else if(s===E.INTEGER)u=l<t.numberNominalLimit&&l/n.count<t.numberNominalProportion?c.NOMINAL:c.QUANTITATIVE;else if(s===E.DATETIME){u=c.TEMPORAL,n.min=new Date(e[0][a]),n.max=new Date(e[0][a]);for(const t of e){const e=new Date(t[a]).getTime();e<n.min.getTime()&&(n.min=new Date(e)),e>n.max.getTime()&&(n.max=new Date(e))}}else u=c.NOMINAL;u===c.NOMINAL&&l/n.count>t.minPercentUniqueForKey&&n.count>t.minCardinalityForKey&&(u=ci.ExpandedType.KEY);let d={name:a,originalIndex:r,vlType:u,type:s,stats:n,timeStats:{},binStats:{}};const f=o[d.name];return d=zt.extend(d,f),d}));for(let e of a)if(e.vlType===c.QUANTITATIVE)for(let n of t.enum.binProps.maxbins)e.binStats[n]=p(n,e.stats);else if(e.vlType===c.TEMPORAL)for(let n of t.enum.timeUnit)if(void 0!==n)if("object"==typeof n){if(!("unit"in n))throw new Error("Unrecognized TimeUnit type when calculating fieldSchema.stats");e.timeStats[n.unit]=h(n.unit,e.stats)}else e.timeStats[n]=h(n,e.stats);const s=Object.assign(Object.assign({},n),{fields:a});return new f(s)};const d={nominal:0,key:1,ordinal:2,temporal:3,quantitative:4};class f{constructor(e){this._tableSchema=e,e.fields.sort((function(e,t){return d[e.vlType]<d[t.vlType]?-1:d[e.vlType]>d[t.vlType]?1:e.name.localeCompare(t.name)})),e.fields.forEach(((e,t)=>e.index=t)),this._fieldSchemaIndex=e.fields.reduce(((e,t)=>(e[t.name]=t,e)),{})}fieldNames(){return this._tableSchema.fields.map((e=>e.name))}get fieldSchemas(){return this._tableSchema.fields}fieldSchema(e){return this._fieldSchemaIndex[e]}tableSchema(){const e=zt.duplicate(this._tableSchema);return e.fields.sort(((e,t)=>e.originalIndex-t.originalIndex)),e}primitiveType(e){return this._fieldSchemaIndex[e]?this._fieldSchemaIndex[e].type:null}vlType(e){return this._fieldSchemaIndex[e]?this._fieldSchemaIndex[e].vlType:null}cardinality(e,t=!0,n=!1){const r=this._fieldSchemaIndex[e.field];if(e.aggregate||Pi.isAutoCountQuery(e)&&e.autoCount)return 1;if(e.bin){let t;t="boolean"==typeof e.bin?{maxbins:Na.autoMaxBins(e.channel)}:"?"===e.bin?{enum:[!0,!1]}:e.bin;const n=t.maxbins;return r.binStats[n]||(r.binStats[n]=p(n,r.stats)),r.binStats[n].distinct}if(e.timeUnit){if(t)switch(e.timeUnit){case u.SECONDS:case u.MINUTES:return 60;case u.HOURS:return 24;case u.DAY:return 7;case u.DATE:return 31;case u.MONTH:return 12;case u.QUARTER:return 4;case u.MILLISECONDS:return 1e3}let i=e.timeUnit,o=r.timeStats;return o&&o[i]||(o=Object.assign(Object.assign({},o),{[i]:h(e.timeUnit,r.stats)})),n?o[i].distinct-m(o[i].unique,["Invalid Date",null]):o[i].distinct}return r?n?r.stats.distinct-m(r.stats.unique,[NaN,null]):r.stats.distinct:null}timeUnitHasVariation(e){if(!e.timeUnit)return;if(e.timeUnit===u.DAY){const t=zt.extend({},e,{timeUnit:u.DATE});if(this.cardinality(t,!1,!0)<=1)return!1}let t=e.timeUnit;for(let n of Oi.TIMEUNIT_PARTS)if(Oi.containsTimeUnit(t,n)){const t=zt.extend({},e,{timeUnit:n});if(this.cardinality(t,!1,!0)<=1)return!1}return!0}domain(e){const t=this._fieldSchemaIndex[e.field];let n=zt.keys(t.stats.unique);return t.vlType===c.QUANTITATIVE?[+t.stats.min,+t.stats.max]:t.type===E.DATETIME?[t.stats.min,t.stats.max]:t.type===E.INTEGER||t.type===E.NUMBER?(n=n.map((e=>+e)),n.sort(zt.cmp)):t.vlType===c.ORDINAL&&t.ordinalDomain?t.ordinalDomain:n.map((e=>"null"===e?null:e)).sort(zt.cmp)}stats(e){const t=this._fieldSchemaIndex[e.field];return t?t.stats:null}}function p(e,t){const n=l({min:t.min,max:t.max,maxbins:e}),r=zt.extend({},t);return r.unique=function(e,t){const n={};for(let r in t){let i;i=null===r?null:isNaN(Number(r))?NaN:e.value(Number(r)),n[i]=(n[i]||0)+t[r]}return n}(n,t.unique),r.distinct=(n.stop-n.start)/n.step,r.min=n.start,r.max=n.stop,r}n.Schema=f;const g={year:"setFullYear",month:"setMonth",date:"setDate",hours:"setHours",minutes:"setMinutes",seconds:"setSeconds",milliseconds:"setMilliseconds",dayofyear:null,week:null,quarter:null,day:null};function y(e,t){const n=g[e];return{setDateMethod:t?"setUTC"+n.substr(3):n,getDateMethod:`get${t?"UTC":""}${n.substr(3)}`}}function h(e,t){const n=zt.extend({},t);let r={};return zt.keys(t.unique).forEach((function(n){let i,o="null"===n?null:new Date(n);i=null===o?null:isNaN(o.getTime())?"Invalid Date":(e===u.DAY?o.getDay():function(e,t){const n=Oi.isUTCTimeUnit(e),r=n?new Date(Date.UTC(1972,0,1,0,0,0,0)):new Date(1972,0,1,0,0,0,0);for(const i of Oi.TIMEUNIT_PARTS)if(Oi.containsTimeUnit(e,i))switch(i){case u.DAY:throw new Error("Cannot convert to TimeUnits containing 'day'");case u.DAYOFYEAR:throw new Error("Cannot convert to TimeUnits containing 'dayofyear'");case u.WEEK:throw new Error("Cannot convert to TimeUnits containing 'week'");case u.QUARTER:{const{getDateMethod:e,setDateMethod:i}=y("month",n);r[i](3*Math.floor(t[e]()/3));break}default:{const{getDateMethod:e,setDateMethod:o}=y(i,n);r[o](t[e]())}}return r}(e,o)).toString(),r[i]=(r[i]||0)+t.unique[n]})),n.unique=r,n.distinct=zt.keys(r).length,n}function m(e,t){return t.reduce((function(t,n){return e[n]?t+1:t}),0)}var E;!function(e){e[e.STRING="string"]="STRING",e[e.NUMBER="number"]="NUMBER",e[e.INTEGER="integer"]="INTEGER",e[e.BOOLEAN="boolean"]="BOOLEAN",e[e.DATETIME="datetime"]="DATETIME"}(E=n.PrimitiveType||(n.PrimitiveType={}))})),Da=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EncodingConstraintModel=t.AbstractConstraintModel=void 0;class n{constructor(e){this.constraint=e}name(){return this.constraint.name}description(){return this.constraint.description}properties(){return this.constraint.properties}strict(){return this.constraint.strict}}t.AbstractConstraintModel=n;t.EncodingConstraintModel=class extends n{constructor(e){super(e)}hasAllRequiredPropertiesSpecific(e){return zt.every(this.constraint.properties,(t=>{if(Jt.isEncodingNestedProp(t)){let n=t.parent,r=t.child;return!e[n]||!Mn.isWildcard(e[n][r])}return!e[t]||!Mn.isWildcard(e[t])}))}satisfy(e,t,n,r){return!this.constraint.allowWildcardForProperties&&!this.hasAllRequiredPropertiesSpecific(e)||this.constraint.satisfy(e,t,n,r)}}})),Ma=n((function(t,n){var r=e&&e.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.FIELD_CONSTRAINTS_BY_PROPERTY=n.FIELD_CONSTRAINT_INDEX=n.FIELD_CONSTRAINTS=void 0;const a=o(Cn),s=o(Dn);n.FIELD_CONSTRAINTS=[{name:"aggregateOpSupportedByType",description:"Aggregate function should be supported by data type.",properties:[Jt.Property.TYPE,Jt.Property.AGGREGATE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n,r)=>!e.aggregate||!ci.isDiscrete(e.type)},{name:"asteriskFieldWithCountOnly",description:'Field="*" should be disallowed except aggregate="count"',properties:[Jt.Property.FIELD,Jt.Property.AGGREGATE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n,r)=>"*"===e.field==("count"===e.aggregate)},{name:"minCardinalityForBin",description:"binned quantitative field should not have too low cardinality",properties:[Jt.Property.BIN,Jt.Property.FIELD,Jt.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n,r)=>{if(e.bin&&e.type===s.QUANTITATIVE){let n={channel:e.channel,field:e.field,type:e.type};return t.cardinality(n)>=r.minCardinalityForBin}return!0}},{name:"binAppliedForQuantitative",description:"bin should be applied to quantitative field only.",properties:[Jt.Property.TYPE,Jt.Property.BIN],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n,r)=>!e.bin||e.type===s.QUANTITATIVE},{name:"channelFieldCompatible",description:"encoding channel's range type be compatible with channel type.",properties:[Jt.Property.CHANNEL,Jt.Property.TYPE,Jt.Property.BIN,Jt.Property.TIMEUNIT],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n,r)=>{var i;const o=Object.assign({field:"f"},Pi.toFieldDef(e,{schema:t,props:["bin","timeUnit","type"]})),{compatible:a}=vi.channelCompatibility(o,e.channel);if(a)return!0;{const t="row"===e.channel||"column"===e.channel||"facet"===e.channel,n=o.timeUnit&&(null===(i=Oi.normalizeTimeUnit(o.timeUnit))||void 0===i?void 0:i.unit);return!(!t||!n||!Oi.isLocalSingleTimeUnit(n)&&!Oi.isUTCTimeUnit(n))}}},{name:"hasFn",description:"A field with as hasFn flag should have one of aggregate, timeUnit, or bin.",properties:[Jt.Property.AGGREGATE,Jt.Property.BIN,Jt.Property.TIMEUNIT],allowWildcardForProperties:!0,strict:!0,satisfy:(e,t,n,r)=>!e.hasFn||(!!e.aggregate||!!e.bin||!!e.timeUnit)},{name:"omitScaleZeroWithBinnedField",description:"Do not use scale zero with binned field",properties:[Jt.Property.SCALE,Jt.getEncodingNestedProp("scale","zero"),Jt.Property.BIN],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n,r)=>!e.bin||!e.scale||!0!==e.scale.zero},{name:"onlyOneTypeOfFunction",description:"Only of of aggregate, autoCount, timeUnit, or bin should be applied at the same time.",properties:[Jt.Property.AGGREGATE,Jt.Property.AUTOCOUNT,Jt.Property.TIMEUNIT,Jt.Property.BIN],allowWildcardForProperties:!0,strict:!0,satisfy:(e,t,n,r)=>{if(Pi.isFieldQuery(e)){return(!Mn.isWildcard(e.aggregate)&&e.aggregate?1:0)+(!Mn.isWildcard(e.bin)&&e.bin?1:0)+(!Mn.isWildcard(e.timeUnit)&&e.timeUnit?1:0)<=1}return!0}},{name:"timeUnitAppliedForTemporal",description:"Time unit should be applied to temporal field only.",properties:[Jt.Property.TYPE,Jt.Property.TIMEUNIT],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n,r)=>!e.timeUnit||e.type===s.TEMPORAL},{name:"timeUnitShouldHaveVariation",description:"A particular time unit should be applied only if they produce unique values.",properties:[Jt.Property.TIMEUNIT,Jt.Property.TYPE],allowWildcardForProperties:!1,strict:!1,satisfy:(e,t,n,r)=>!e.timeUnit||e.type!==s.TEMPORAL||(!n.has("timeUnit")&&!r.constraintManuallySpecifiedValue||t.timeUnitHasVariation(e))},{name:"scalePropertiesSupportedByScaleType",description:"Scale properties must be supported by correct scale type",properties:[].concat(Jt.SCALE_PROPS,[Jt.Property.SCALE,Jt.Property.TYPE]),allowWildcardForProperties:!0,strict:!0,satisfy:(e,t,n,r)=>{if(e.scale){const t=e.scale,n=Pi.scaleType(e);if(null==n)return!0;for(let e in t){if("type"===e||"name"===e||"enum"===e)continue;const t=e;if("point"===n){if(!Xt.scaleTypeSupportProperty("point",t)&&!Xt.scaleTypeSupportProperty("band",t))return!1}else if(!Xt.scaleTypeSupportProperty(n,t))return!1}}return!0}},{name:"scalePropertiesSupportedByChannel",description:"Not all scale properties are supported by all encoding channels",properties:[].concat(Jt.SCALE_PROPS,[Jt.Property.SCALE,Jt.Property.CHANNEL]),allowWildcardForProperties:!0,strict:!0,satisfy:(e,t,n,r)=>{if(e){let t=e.channel,n=e.scale;if(t&&!Mn.isWildcard(t)&&n){if("row"===t||"column"===t||"facet"===t)return!1;for(let e in n){if(!n.hasOwnProperty(e))continue;if("type"===e||"name"===e||"enum"===e)continue;if(!(void 0===Xt.channelScalePropertyIncompatability(t,e)))return!1}}}return!0}},{name:"typeMatchesPrimitiveType",description:"Data type should be supported by field's primitive type.",properties:[Jt.Property.FIELD,Jt.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n,r)=>{if("*"===e.field)return!0;const i=t.primitiveType(e.field),o=e.type;if(!n.has("field")&&!n.has("type")&&!r.constraintManuallySpecifiedValue)return!0;switch(i){case Ia.PrimitiveType.BOOLEAN:case Ia.PrimitiveType.STRING:return o!==s.QUANTITATIVE&&o!==s.TEMPORAL;case Ia.PrimitiveType.NUMBER:case Ia.PrimitiveType.INTEGER:return o!==s.TEMPORAL;case Ia.PrimitiveType.DATETIME:return o===s.TEMPORAL;case null:return!1}throw new Error("Not implemented")}},{name:"typeMatchesSchemaType",description:"Enumerated data type of a field should match the field's type in the schema.",properties:[Jt.Property.FIELD,Jt.Property.TYPE],allowWildcardForProperties:!1,strict:!1,satisfy:(e,t,n,r)=>!(n.has("field")||n.has("type")||r.constraintManuallySpecifiedValue)||("*"===e.field?e.type===s.QUANTITATIVE:t.vlType(e.field)===e.type)},{name:"maxCardinalityForCategoricalColor",description:"Categorical channel should not have too high cardinality",properties:[Jt.Property.CHANNEL,Jt.Property.FIELD],allowWildcardForProperties:!1,strict:!1,satisfy:(e,t,n,r)=>e.channel!==a.COLOR||e.type!==s.NOMINAL&&e.type!==ci.ExpandedType.KEY||t.cardinality(e)<=r.maxCardinalityForCategoricalColor},{name:"maxCardinalityForFacet",description:"Row/column channel should not have too high cardinality",properties:[Jt.Property.CHANNEL,Jt.Property.FIELD,Jt.Property.BIN,Jt.Property.TIMEUNIT],allowWildcardForProperties:!1,strict:!1,satisfy:(e,t,n,r)=>e.channel!==a.ROW&&e.channel!==a.COLUMN||t.cardinality(e)<=r.maxCardinalityForFacet},{name:"maxCardinalityForShape",description:"Shape channel should not have too high cardinality",properties:[Jt.Property.CHANNEL,Jt.Property.FIELD,Jt.Property.BIN,Jt.Property.TIMEUNIT],allowWildcardForProperties:!1,strict:!1,satisfy:(e,t,n,r)=>e.channel!==a.SHAPE||t.cardinality(e)<=r.maxCardinalityForShape},{name:"dataTypeAndFunctionMatchScaleType",description:"Scale type must match data type",properties:[Jt.Property.TYPE,Jt.Property.SCALE,Jt.getEncodingNestedProp("scale","type"),Jt.Property.TIMEUNIT,Jt.Property.BIN],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n,r)=>{if(e.scale){const t=e.type,n=Pi.scaleType(e);if(ci.isDiscrete(t))return void 0===n||Xt.hasDiscreteDomain(n);if(t===s.TEMPORAL)return e.timeUnit?zt.contains([Xt.ScaleType.TIME,Xt.ScaleType.UTC,void 0],n)||Xt.hasDiscreteDomain(n):zt.contains([Xt.ScaleType.TIME,Xt.ScaleType.UTC,void 0],n);if(t===s.QUANTITATIVE)return e.bin?zt.contains([Xt.ScaleType.LINEAR,void 0],n):zt.contains([Xt.ScaleType.LOG,Xt.ScaleType.POW,Xt.ScaleType.SQRT,Xt.ScaleType.QUANTILE,Xt.ScaleType.QUANTIZE,Xt.ScaleType.LINEAR,void 0],n)}return!0}},{name:"stackIsOnlyUsedWithXY",description:"stack should only be allowed for x and y channels",properties:[Jt.Property.STACK,Jt.Property.CHANNEL],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n,r)=>!e.stack||(e.channel===a.X||e.channel===a.Y)}].map((e=>new Da.EncodingConstraintModel(e))),n.FIELD_CONSTRAINT_INDEX=n.FIELD_CONSTRAINTS.reduce(((e,t)=>(e[t.name()]=t,e)),{}),n.FIELD_CONSTRAINTS_BY_PROPERTY=n.FIELD_CONSTRAINTS.reduce(((e,t)=>{for(const n of t.properties())e.set(n,e.get(n)||[]),e.get(n).push(t);return e}),new ui.PropIndex)})),Ra=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.VALUE_CONSTRAINTS_BY_PROPERTY=t.VALUE_CONSTRAINT_INDEX=t.VALUE_CONSTRAINTS=void 0,t.VALUE_CONSTRAINTS=[{name:"doesNotSupportConstantValue",description:"row, column, x, y, order, and detail should not work with constant values.",properties:[Jt.Property.TYPE,Jt.Property.AGGREGATE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n,r)=>!zt.contains(["row","column","x","y","detail","order"],e.channel)}].map((e=>new Da.EncodingConstraintModel(e))),t.VALUE_CONSTRAINT_INDEX=t.VALUE_CONSTRAINTS.reduce(((e,t)=>(e[t.name()]=t,e)),{}),t.VALUE_CONSTRAINTS_BY_PROPERTY=t.VALUE_CONSTRAINTS.reduce(((e,t)=>{for(const n of t.properties())e.set(n,e.get(n)||[]),e.get(n).push(t);return e}),new ui.PropIndex)})),wa=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.checkEncoding=void 0,t.checkEncoding=function(e,t,n,r,i,o){const a=Ma.FIELD_CONSTRAINTS_BY_PROPERTY.get(e)||[],s=r.getEncodingQueryByIndex(n);for(const e of a)if(e.strict()||o[e.name()]){if(!e.satisfy(s,i,r.wildcardIndex.encodings[n],o)){let n="(enc) "+e.name();return o.verbose&&console.log(`${n} failed with ${r.toShorthand()} for ${t.name}`),n}}const c=Ra.VALUE_CONSTRAINTS_BY_PROPERTY.get(e)||[];for(const e of c)if((e.strict()||o[e.name()])&&Pi.isValueQuery(s)){if(!e.satisfy(s,i,r.wildcardIndex.encodings[n],o)){let n="(enc) "+e.name();return o.verbose&&console.log(`${n} failed with ${r.toShorthand()} for ${t.name}`),n}}return null}})),Ua=n((function(t,n){var r=e&&e.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.checkSpec=n.SPEC_CONSTRAINT_INDEX=n.SPEC_CONSTRAINTS=n.SpecConstraintModel=void 0;const a=o(Cn),s=Cn,c=o(In),u=o(Dn),l=s.NONPOSITION_CHANNELS.reduce(((e,t)=>(e[t]=!0,e)),{});class d extends Da.AbstractConstraintModel{constructor(e){super(e)}hasAllRequiredPropertiesSpecific(e){return zt.every(this.constraint.properties,(t=>{if(t===Jt.Property.MARK)return!Mn.isWildcard(e.getMark());if(Jt.isEncodingNestedProp(t)){let n=t.parent,r=t.child;return zt.every(e.getEncodings(),(e=>!e[n]||!Mn.isWildcard(e[n][r])))}if(!Jt.isEncodingProperty(t))throw new Error("UNIMPLEMENTED");return zt.every(e.getEncodings(),(e=>!e[t]||!Mn.isWildcard(e[t])))}))}satisfy(e,t,n){return!this.constraint.allowWildcardForProperties&&!this.hasAllRequiredPropertiesSpecific(e)||this.constraint.satisfy(e,t,n)}}n.SpecConstraintModel=d,n.SPEC_CONSTRAINTS=[{name:"noRepeatedChannel",description:"Each encoding channel should only be used once.",properties:[Jt.Property.CHANNEL],allowWildcardForProperties:!0,strict:!0,satisfy:(e,t,n)=>{let r={};return zt.every(e.getEncodings(),(e=>!!Mn.isWildcard(e.channel)||!r[e.channel]&&(r[e.channel]=!0,!0)))}},{name:"alwaysIncludeZeroInScaleWithBarMark",description:"Do not recommend bar mark if scale does not start at zero",properties:[Jt.Property.MARK,Jt.Property.SCALE,Jt.getEncodingNestedProp("scale","zero"),Jt.Property.CHANNEL,Jt.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n)=>{const r=e.getMark(),i=e.getEncodings();if(r===c.BAR)for(let e of i)if(Pi.isFieldQuery(e)&&(e.channel===a.X||e.channel===a.Y)&&e.type===u.QUANTITATIVE&&e.scale&&!1===e.scale.zero)return!1;return!0}},{name:"autoAddCount",description:"Automatically adding count only for plots with only ordinal, binned quantitative, or temporal with timeunit fields.",properties:[Jt.Property.BIN,Jt.Property.TIMEUNIT,Jt.Property.TYPE,Jt.Property.AUTOCOUNT],allowWildcardForProperties:!0,strict:!1,satisfy:(e,t,n)=>{if(zt.some(e.getEncodings(),(e=>Pi.isEnabledAutoCountQuery(e))))return zt.every(e.getEncodings(),(e=>{if(Pi.isValueQuery(e))return!0;if(Pi.isAutoCountQuery(e))return!0;switch(e.type){case u.QUANTITATIVE:return!!e.bin;case u.TEMPORAL:return!!e.timeUnit;case u.ORDINAL:case ci.ExpandedType.KEY:case u.NOMINAL:return!0}throw new Error("Unsupported Type")}));{const t=e.wildcardIndex.encodingIndicesByProperty.get("autoCount")||[];if(zt.every(t,(t=>{let n=e.getEncodingQueryByIndex(t);return Pi.isAutoCountQuery(n)&&!Mn.isWildcard(n.autoCount)})))return zt.some(e.getEncodings(),(e=>(Pi.isFieldQuery(e)||Pi.isAutoCountQuery(e))&&e.type===u.QUANTITATIVE?!Pi.isDisabledAutoCountQuery(e)&&(Pi.isFieldQuery(e)&&(!e.bin||Mn.isWildcard(e.bin))):!(!Pi.isFieldQuery(e)||e.type!==u.TEMPORAL)&&(!e.timeUnit||Mn.isWildcard(e.timeUnit))))}return!0}},{name:"channelPermittedByMarkType",description:"Each encoding channel should be supported by the mark type",properties:[Jt.Property.CHANNEL,Jt.Property.MARK],allowWildcardForProperties:!0,strict:!0,satisfy:(e,t,n)=>{const r=e.getMark();return!!Mn.isWildcard(r)||zt.every(e.getEncodings(),(e=>!!Mn.isWildcard(e.channel)||("row"===e.channel||"column"===e.channel||"facet"===e.channel||!!s.supportMark(e.channel,r))))}},{name:"hasAllRequiredChannelsForMark",description:"All required channels for the specified mark should be specified",properties:[Jt.Property.CHANNEL,Jt.Property.MARK],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n)=>{const r=e.getMark();switch(r){case c.AREA:case c.LINE:return e.channelUsed(a.X)&&e.channelUsed(a.Y);case c.TEXT:return e.channelUsed(a.TEXT);case c.BAR:case c.CIRCLE:case c.SQUARE:case c.TICK:case c.RULE:case c.RECT:return e.channelUsed(a.X)||e.channelUsed(a.Y);case c.POINT:return!e.wildcardIndex.hasProperty(Jt.Property.CHANNEL)||e.channelUsed(a.X)||e.channelUsed(a.Y)}throw new Error("hasAllRequiredChannelsForMark not implemented for mark"+JSON.stringify(r))}},{name:"omitAggregate",description:"Omit aggregate plots.",properties:[Jt.Property.AGGREGATE,Jt.Property.AUTOCOUNT],allowWildcardForProperties:!0,strict:!1,satisfy:(e,t,n)=>!e.isAggregate()},{name:"omitAggregatePlotWithDimensionOnlyOnFacet",description:"Omit aggregate plots with dimensions only on facets as that leads to inefficient use of space.",properties:[Jt.Property.CHANNEL,Jt.Property.AGGREGATE,Jt.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:(e,t,n)=>{if(e.isAggregate()){let t=!1,r=!1,i=!1;if(e.specQuery.encodings.forEach(((n,o)=>{Pi.isValueQuery(n)||Pi.isDisabledAutoCountQuery(n)||Pi.isFieldQuery(n)&&!n.aggregate&&(r=!0,zt.contains([a.ROW,a.COLUMN],n.channel)?e.wildcardIndex.hasEncodingProperty(o,Jt.Property.CHANNEL)&&(i=!0):t=!0)})),r&&!t&&(i||n.constraintManuallySpecifiedValue))return!1}return!0}},{name:"omitAggregatePlotWithoutDimension",description:"Aggregate plots without dimension should be omitted",properties:[Jt.Property.AGGREGATE,Jt.Property.AUTOCOUNT,Jt.Property.BIN,Jt.Property.TIMEUNIT,Jt.Property.TYPE],allowWildcardForProperties:!1,strict:!1,satisfy:(e,t,n)=>!e.isAggregate()||zt.some(e.getEncodings(),(e=>!!(Pi.isDimension(e)||Pi.isFieldQuery(e)&&"temporal"===e.type)))},{name:"omitBarLineAreaWithOcclusion",description:"Don't use bar, line or area to visualize raw plot as they often lead to occlusion.",properties:[Jt.Property.MARK,Jt.Property.AGGREGATE,Jt.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:(e,t,n)=>!zt.contains([c.BAR,c.LINE,c.AREA],e.getMark())||e.isAggregate()},{name:"omitBarTickWithSize",description:"Do not map field to size channel with bar and tick mark",properties:[Jt.Property.CHANNEL,Jt.Property.MARK],allowWildcardForProperties:!0,strict:!1,satisfy:(e,t,n)=>{const r=e.getMark();if(zt.contains([c.TICK,c.BAR],r)&&e.channelEncodingField(a.SIZE)){if(n.constraintManuallySpecifiedValue)return!1;{const t=e.specQuery.encodings;for(let n=0;n<t.length;n++){if(t[n].channel===a.SIZE)return!e.wildcardIndex.hasEncodingProperty(n,Jt.Property.CHANNEL)}}}return!0}},{name:"omitBarAreaForLogScale",description:"Do not use bar and area mark for x and y's log scale",properties:[Jt.Property.MARK,Jt.Property.CHANNEL,Jt.Property.SCALE,Jt.getEncodingNestedProp("scale","type"),Jt.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n)=>{const r=e.getMark(),i=e.getEncodings();if(r===c.AREA||r===c.BAR)for(let e of i)if(Pi.isFieldQuery(e)&&(e.channel===a.X||e.channel===a.Y)&&e.scale){if(Pi.scaleType(e)===Xt.ScaleType.LOG)return!1}return!0}},{name:"omitMultipleNonPositionalChannels",description:"Unless manually specified, do not use multiple non-positional encoding channel to avoid over-encoding.",properties:[Jt.Property.CHANNEL],allowWildcardForProperties:!0,strict:!1,satisfy:(e,t,n)=>{const r=e.specQuery.encodings;let i=0,o=!1;for(let t=0;t<r.length;t++){const a=r[t];if(Pi.isValueQuery(a)||Pi.isDisabledAutoCountQuery(a))continue;const s=a.channel;if(!Mn.isWildcard(s)&&l[""+s]&&(i+=1,e.wildcardIndex.hasEncodingProperty(t,Jt.Property.CHANNEL)&&(o=!0),i>1&&(o||n.constraintManuallySpecifiedValue)))return!1}return!0}},{name:"omitNonPositionalOrFacetOverPositionalChannels",description:"Do not use non-positional channels unless all positional channels are used",properties:[Jt.Property.CHANNEL],allowWildcardForProperties:!1,strict:!1,satisfy:(e,t,n)=>{const r=e.specQuery.encodings;let i=!1,o=!1,s=!1,c=!1;for(let t=0;t<r.length;t++){const n=r[t];if(Pi.isValueQuery(n)||Pi.isDisabledAutoCountQuery(n))continue;const u=n.channel;u===a.X?s=!0:u===a.Y?c=!0:Mn.isWildcard(u)||(i=!0,e.wildcardIndex.hasEncodingProperty(t,Jt.Property.CHANNEL)&&(o=!0))}return!(o||n.constraintManuallySpecifiedValue&&i)||s&&c}},{name:"omitRaw",description:"Omit raw plots.",properties:[Jt.Property.AGGREGATE,Jt.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:(e,t,n)=>!!e.isAggregate()},{name:"omitRawContinuousFieldForAggregatePlot",description:"Aggregate plot should not use raw continuous field as group by values. (Quantitative should be binned. Temporal should have time unit.)",properties:[Jt.Property.AGGREGATE,Jt.Property.AUTOCOUNT,Jt.Property.TIMEUNIT,Jt.Property.BIN,Jt.Property.TYPE],allowWildcardForProperties:!0,strict:!1,satisfy:(e,t,n)=>{if(e.isAggregate()){const t=e.specQuery.encodings;for(let r=0;r<t.length;r++){const i=t[r];if(!Pi.isValueQuery(i)&&!Pi.isDisabledAutoCountQuery(i)){if(Pi.isFieldQuery(i)&&i.type===u.TEMPORAL&&!i.timeUnit&&(e.wildcardIndex.hasEncodingProperty(r,Jt.Property.TIMEUNIT)||n.constraintManuallySpecifiedValue))return!1;if(i.type===u.QUANTITATIVE&&Pi.isFieldQuery(i)&&!i.bin&&!i.aggregate){if(e.wildcardIndex.hasEncodingProperty(r,Jt.Property.BIN)||e.wildcardIndex.hasEncodingProperty(r,Jt.Property.AGGREGATE)||e.wildcardIndex.hasEncodingProperty(r,Jt.Property.AUTOCOUNT))return!1;if(n.constraintManuallySpecifiedValue)return!1}}}}return!0}},{name:"omitRawDetail",description:"Do not use detail channel with raw plot.",properties:[Jt.Property.CHANNEL,Jt.Property.AGGREGATE,Jt.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n)=>!!e.isAggregate()||zt.every(e.specQuery.encodings,((t,r)=>!(!Pi.isValueQuery(t)&&!Pi.isDisabledAutoCountQuery(t))||(t.channel!==a.DETAIL||!e.wildcardIndex.hasEncodingProperty(r,Jt.Property.CHANNEL)&&!n.constraintManuallySpecifiedValue)))},{name:"omitRepeatedField",description:"Each field should be mapped to only one channel",properties:[Jt.Property.FIELD],allowWildcardForProperties:!0,strict:!1,satisfy:(e,t,n)=>{let r={},i={};const o=e.specQuery.encodings;for(let t=0;t<o.length;t++){const a=o[t];if(Pi.isValueQuery(a)||Pi.isAutoCountQuery(a))continue;let s;if(a.field&&!Mn.isWildcard(a.field)&&(s=a.field),Pi.isAutoCountQuery(a)&&!Mn.isWildcard(a.autoCount)&&(s="count_*"),s){if(e.wildcardIndex.hasEncodingProperty(t,Jt.Property.FIELD)&&(i[s]=!0),r[s]&&(i[s]||n.constraintManuallySpecifiedValue))return!1;r[s]=!0}}return!0}},{name:"omitVerticalDotPlot",description:"Do not output vertical dot plot.",properties:[Jt.Property.CHANNEL],allowWildcardForProperties:!0,strict:!1,satisfy:(e,t,n)=>{const r=e.getEncodings();return 1!==r.length||r[0].channel!==a.Y}},{name:"hasAppropriateGraphicTypeForMark",description:"Has appropriate graphic type for mark",properties:[Jt.Property.CHANNEL,Jt.Property.MARK,Jt.Property.TYPE,Jt.Property.TIMEUNIT,Jt.Property.BIN,Jt.Property.AGGREGATE,Jt.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:(e,t,n)=>{const r=e.getMark();switch(r){case c.AREA:case c.LINE:if(e.isAggregate()){const t=e.getEncodingQueryByChannel(a.X),n=e.getEncodingQueryByChannel(a.Y),r=Pi.isMeasure(t),i=Pi.isMeasure(n);return t&&n&&r!==i&&!(Pi.isFieldQuery(t)&&!r&&zt.contains(["nominal","key"],t.type))&&!(Pi.isFieldQuery(n)&&!i&&zt.contains(["nominal","key"],n.type))}return!0;case c.TEXT:return!0;case c.BAR:case c.TICK:if(e.channelEncodingField(a.SIZE))return!1;{const t=e.getEncodingQueryByChannel(a.X),n=e.getEncodingQueryByChannel(a.Y);return Pi.isMeasure(t)!==Pi.isMeasure(n)}case c.RECT:const t=e.getEncodingQueryByChannel(a.X),n=e.getEncodingQueryByChannel(a.Y),r=Pi.isDimension(t),i=Pi.isDimension(n),o=e.getEncodingQueryByChannel(a.COLOR),s=Pi.isMeasure(o),l=!!Pi.isFieldQuery(o)&&o.type===u.ORDINAL,d=r&&i||r&&!e.channelUsed(a.Y)||i&&!e.channelUsed(a.X),f=!o||o&&(s||l);return d&&f;case c.CIRCLE:case c.POINT:case c.SQUARE:case c.RULE:return!0}throw new Error("hasAllRequiredChannelsForMark not implemented for mark"+r)}},{name:"omitInvalidStackSpec",description:"If stack is specified, must follow Vega-Lite stack rules",properties:[Jt.Property.STACK,Jt.Property.FIELD,Jt.Property.CHANNEL,Jt.Property.MARK,Jt.Property.AGGREGATE,Jt.Property.AUTOCOUNT,Jt.Property.SCALE,Jt.getEncodingNestedProp("scale","type"),Jt.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n)=>{if(!e.wildcardIndex.hasProperty(Jt.Property.STACK))return!0;const r=e.getVlStack();return(null!==r||null===e.getStackOffset())&&r.fieldChannel===e.getStackChannel()}},{name:"omitNonSumStack",description:"Stack specifications that use non-summative aggregates should be omitted (even implicit ones)",properties:[Jt.Property.CHANNEL,Jt.Property.MARK,Jt.Property.AGGREGATE,Jt.Property.AUTOCOUNT,Jt.Property.SCALE,Jt.getEncodingNestedProp("scale","type"),Jt.Property.TYPE],allowWildcardForProperties:!1,strict:!0,satisfy:(e,t,n)=>{const r=e.getVlStack();if(null!=r){const t=e.getEncodingQueryByChannel(r.fieldChannel);if(!zt.contains(Ei.SUM_OPS,t.aggregate))return!1}return!0}},{name:"omitTableWithOcclusionIfAutoAddCount",description:"Plots without aggregation or autocount where x and y are both discrete should be omitted if autoAddCount is enabled as they often lead to occlusion",properties:[Jt.Property.CHANNEL,Jt.Property.TYPE,Jt.Property.TIMEUNIT,Jt.Property.BIN,Jt.Property.AGGREGATE,Jt.Property.AUTOCOUNT],allowWildcardForProperties:!1,strict:!1,satisfy:(e,t,n)=>{if(n.autoAddCount){const t=e.getEncodingQueryByChannel("x"),n=e.getEncodingQueryByChannel("y");if((!Pi.isFieldQuery(t)||Pi.isDimension(t))&&(!Pi.isFieldQuery(n)||Pi.isDimension(n)))return!!e.isAggregate()&&zt.every(e.getEncodings(),(e=>{let t=e.channel;return!(t!==a.X&&t!==a.Y&&t!==a.ROW&&t!==a.COLUMN&&Pi.isFieldQuery(e)&&!e.aggregate)}))}return!0}}].map((e=>new d(e))),n.SPEC_CONSTRAINT_INDEX=n.SPEC_CONSTRAINTS.reduce(((e,t)=>(e[t.name()]=t,e)),{});const f=n.SPEC_CONSTRAINTS.reduce(((e,t)=>{for(const n of t.properties())e.set(n,e.get(n)||[]),e.get(n).push(t);return e}),new ui.PropIndex);n.checkSpec=function(e,t,n,r,i){const o=f.get(e)||[];for(const e of o)if(e.strict()||i[e.name()]){if(!e.satisfy(n,r,i)){let r="(spec) "+e.name();return i.verbose&&console.log(`${r} failed with ${n.toShorthand()} for ${t.name}`),r}}return null}})),Fa=n((function(t,n){var r=e&&e.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.spec=n.encoding=void 0;const a=o(wa);n.encoding=a;const s=o(Ua);n.spec=s})),xa=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EncodingPropertyGeneratorFactory=t.getEnumerator=void 0;const n=new ui.PropIndex;function r(e){return(t,n,r)=>(i,o)=>{const a=t.encodingIndicesByProperty.get(e);return function s(c){if(c===a.length)return void i.push(o.duplicate());const u=a[c],l=t.encodings[u].get(e),d=o.getEncodingQueryByIndex(u),f=o.getEncodingProperty(u,e);Pi.isValueQuery(d)||Pi.isDisabledAutoCountQuery(d)||!f?s(c+1):(l.enum.forEach((t=>{null===t&&(t=void 0),o.setEncodingProperty(u,e,t,l);if(wa.checkEncoding(e,l,u,o,n,r))return;Ua.checkSpec(e,l,o,n,r)||s(c+1)})),o.resetEncodingProperty(u,e,l))}(0),i}}t.getEnumerator=function(e){return n.get(e)},n.set("mark",((e,t,n)=>(r,i)=>(i.getMark().enum.forEach((o=>{i.setMark(o);Ua.checkSpec("mark",e.mark,i,t,n)||r.push(i.duplicate())})),i.resetMark(),r))),Jt.ENCODING_TOPLEVEL_PROPS.forEach((e=>{n.set(e,r(e))})),Jt.ENCODING_NESTED_PROPS.forEach((e=>{n.set(e,r(e))})),t.EncodingPropertyGeneratorFactory=r})),La=n((function(e,t){function n(e){return qt.isObject(e)&&!!e.property}Object.defineProperty(t,"__esModule",{value:!0}),t.GROUP_BY_ENCODING=t.GROUP_BY_FIELD_TRANSFORM=t.toString=t.parseGroupBy=t.isExtendedGroupBy=t.REPLACE_MARK_STYLE_CHANNELS=t.REPLACE_FACET_CHANNELS=t.REPLACE_XY_CHANNELS=t.REPLACE_BLANK_FIELDS=void 0,t.REPLACE_BLANK_FIELDS={"*":""},t.REPLACE_XY_CHANNELS={x:"xy",y:"xy"},t.REPLACE_FACET_CHANNELS={row:"facet",column:"facet"},t.REPLACE_MARK_STYLE_CHANNELS={color:"style",opacity:"style",shape:"style",size:"style"},t.isExtendedGroupBy=n,t.parseGroupBy=function(e,t,r){return t=t||new ui.PropIndex,r=r||new ui.PropIndex,e.forEach((e=>{n(e)?(t.setByKey(e.property,!0),r.setByKey(e.property,e.replace)):t.setByKey(e,!0)})),{include:t,replaceIndex:r,replacer:Ti.getReplacerIndex(r)}},t.toString=function(e){return qt.isArray(e)?e.map((e=>{if(n(e)){if(e.replace){let t=zt.keys(e.replace).reduce(((t,n)=>{const r=e.replace[n];return(t[r]=t[r]||[]).push(n),t}),{});return e.property+"["+zt.keys(t).map((e=>`${t[e].sort().join(",")}=>${e}`)).join(";")+"]"}return e.property}return e})).join(","):e},t.GROUP_BY_FIELD_TRANSFORM=[Jt.Property.FIELD,Jt.Property.TYPE,Jt.Property.AGGREGATE,Jt.Property.BIN,Jt.Property.TIMEUNIT,Jt.Property.STACK],t.GROUP_BY_ENCODING=t.GROUP_BY_FIELD_TRANSFORM.concat([{property:Jt.Property.CHANNEL,replace:{x:"xy",y:"xy",color:"style",size:"style",shape:"style",opacity:"style",row:"facet",column:"facet"}}])})),ka=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PARSED_GROUP_BY_ENCODING=t.PARSED_GROUP_BY_FIELD_TRANSFORM=t.getGroupByKey=t.nest=t.SPEC=t.ENCODING=t.FIELD_TRANSFORM=t.FIELD=t.registerKeyFn=void 0;let n={};function r(e,t){n[e]=t}t.registerKeyFn=r,t.FIELD="field",t.FIELD_TRANSFORM="fieldTransform",t.ENCODING="encoding",t.SPEC="spec",t.nest=function(e,t){if(t){const r={name:"",path:"",items:[]};let i={},o=[],a=[],s=[];for(let e=0;e<t.length;e++){o.push(e>0?o[e-1].duplicate():new ui.PropIndex),a.push(e>0?a[e-1].duplicate():new ui.PropIndex);const n=t[e].groupBy;if(qt.isArray(n)){let t=La.parseGroupBy(n,o[e],a[e]);s.push(t.replacer)}}return e.forEach((e=>{let a="",c=r;for(let r=0;r<t.length;r++){const u=c.groupBy=t[r].groupBy;c.orderGroupBy=t[r].orderGroupBy;const l=qt.isArray(u)?Ti.spec(e.specQuery,o[r],s[r]):n[u](e.specQuery);a+="/"+l,i[a]||(i[a]={name:l,path:a,items:[]},c.items.push(i[a])),c=i[a]}c.items.push(e)})),r}return{name:"",path:"",items:e}};const i=[Jt.Property.FIELD],o=La.parseGroupBy(i);t.getGroupByKey=function(e,t){return n[t](e)},r(t.FIELD,(e=>Ti.spec(e,o.include,o.replacer))),t.PARSED_GROUP_BY_FIELD_TRANSFORM=La.parseGroupBy(La.GROUP_BY_FIELD_TRANSFORM),r(t.FIELD_TRANSFORM,(e=>Ti.spec(e,t.PARSED_GROUP_BY_FIELD_TRANSFORM.include,t.PARSED_GROUP_BY_FIELD_TRANSFORM.replacer))),t.PARSED_GROUP_BY_ENCODING=La.parseGroupBy(La.GROUP_BY_ENCODING),r(t.ENCODING,(e=>Ti.spec(e,t.PARSED_GROUP_BY_ENCODING.include,t.PARSED_GROUP_BY_ENCODING.replacer))),r(t.SPEC,(e=>JSON.stringify(e)))})),ja=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.WildcardIndex=void 0;t.WildcardIndex=class{constructor(){this._mark=void 0,this._encodings={},this._encodingIndicesByProperty=new ui.PropIndex}setEncodingProperty(e,t,n){const r=this._encodings;(r[e]=r[e]||new ui.PropIndex).set(t,n);const i=this._encodingIndicesByProperty;return i.set(t,i.get(t)||[]),i.get(t).push(e),this}hasEncodingProperty(e,t){return!!this._encodings[e]&&this._encodings[e].has(t)}hasProperty(e){if(Jt.isEncodingProperty(e))return this.encodingIndicesByProperty.has(e);if("mark"===e)return!!this.mark;throw new Error("Unimplemented for property "+e)}isEmpty(){return!this.mark&&0===this.encodingIndicesByProperty.size()}setMark(e){return this._mark=e,this}get mark(){return this._mark}get encodings(){return this._encodings}get encodingIndicesByProperty(){return this._encodingIndicesByProperty}}})),Ba=n((function(t,n){var r=e&&e.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.SpecQueryModel=void 0;const a=o(Dn);class s{constructor(e,t,n,r,i){this._rankingScore={},this._spec=e,this._channelFieldCount=e.encodings.reduce(((e,t)=>(Mn.isWildcard(t.channel)||Pi.isAutoCountQuery(t)&&!1===t.autoCount||(e[""+t.channel]=1),e)),{}),this._wildcardIndex=t,this._assignedWildcardIndex=i,this._opt=r,this._schema=n}static build(e,t,n){let r=new ja.WildcardIndex;if(Mn.isWildcard(e.mark)){const t=Mn.getDefaultName(Jt.Property.MARK);e.mark=Mn.initWildcard(e.mark,t,n.enum.mark),r.setMark(e.mark)}if(e.encodings.forEach(((e,i)=>{Pi.isAutoCountQuery(e)&&(console.warn("A field with autoCount should not be included as autoCount meant to be an internal object."),e.type=a.QUANTITATIVE),Pi.isFieldQuery(e)&&void 0===e.type&&(e.type=Mn.SHORT_WILDCARD),Jt.ENCODING_TOPLEVEL_PROPS.forEach((o=>{if(Mn.isWildcard(e[o])){const a=Mn.getDefaultName(o)+i,s=Mn.getDefaultEnumValues(o,t,n),c=e[o]=Mn.initWildcard(e[o],a,s);r.setEncodingProperty(i,o,c)}})),Jt.ENCODING_NESTED_PROPS.forEach((o=>{const a=e[o.parent];if(a){const e=o.child;if(Mn.isWildcard(a[e])){const s=Mn.getDefaultName(o)+i,c=Mn.getDefaultEnumValues(o,t,n),u=a[e]=Mn.initWildcard(a[e],s,c);r.setEncodingProperty(i,o,u)}}}))})),n.autoAddCount){const i={name:Mn.getDefaultName(Jt.Property.CHANNEL)+e.encodings.length,enum:Mn.getDefaultEnumValues(Jt.Property.CHANNEL,t,n)},o={name:Mn.getDefaultName(Jt.Property.AUTOCOUNT)+e.encodings.length,enum:[!1,!0]},s={channel:i,autoCount:o,type:a.QUANTITATIVE};e.encodings.push(s);const c=e.encodings.length-1;r.setEncodingProperty(c,Jt.Property.CHANNEL,i),r.setEncodingProperty(c,Jt.Property.AUTOCOUNT,o)}return new s(e,r,t,n,{})}get wildcardIndex(){return this._wildcardIndex}get schema(){return this._schema}get specQuery(){return this._spec}duplicate(){return new s(zt.duplicate(this._spec),this._wildcardIndex,this._schema,this._opt,zt.duplicate(this._assignedWildcardIndex))}setMark(e){const t=this._wildcardIndex.mark.name;this._assignedWildcardIndex[t]=this._spec.mark=e}resetMark(){const e=this._spec.mark=this._wildcardIndex.mark;delete this._assignedWildcardIndex[e.name]}getMark(){return this._spec.mark}getEncodingProperty(e,t){const n=this._spec.encodings[e];return Jt.isEncodingNestedProp(t)?n[t.parent][t.child]:n[t]}setEncodingProperty(e,t,n,r){const i=this._spec.encodings[e];t===Jt.Property.CHANNEL&&i.channel&&!Mn.isWildcard(i.channel)&&this._channelFieldCount[i.channel]--,Jt.isEncodingNestedProp(t)?i[t.parent][t.child]=n:Jt.isEncodingNestedParent(t)&&!0===n?i[t]=zt.extend({},i[t],{enum:void 0,name:void 0}):i[t]=n,this._assignedWildcardIndex[r.name]=n,t===Jt.Property.CHANNEL&&(this._channelFieldCount[n]=(this._channelFieldCount[n]||0)+1)}resetEncodingProperty(e,t,n){const r=this._spec.encodings[e];t===Jt.Property.CHANNEL&&this._channelFieldCount[r.channel]--,Jt.isEncodingNestedProp(t)?r[t.parent][t.child]=n:r[t]=n,delete this._assignedWildcardIndex[n.name]}channelUsed(e){return this._channelFieldCount[e]>0}channelEncodingField(e){const t=this.getEncodingQueryByChannel(e);return Pi.isFieldQuery(t)}getEncodings(){return this._spec.encodings.filter((e=>!Pi.isDisabledAutoCountQuery(e)))}getEncodingQueryByChannel(e){for(let t of this._spec.encodings)if(t.channel===e)return t}getEncodingQueryByIndex(e){return this._spec.encodings[e]}isAggregate(){return mi.isAggregate(this._spec)}getVlStack(){return mi.getVlStack(this._spec)}getStackOffset(){return mi.getStackOffset(this._spec)}getStackChannel(){return mi.getStackChannel(this._spec)}toShorthand(e){if(e){if(qt.isString(e))return ka.getGroupByKey(this.specQuery,e);const t=La.parseGroupBy(e);return Ti.spec(this._spec,t.include,t.replacer)}return Ti.spec(this._spec)}toSpec(e){if(Mn.isWildcard(this._spec.mark))return null;let t={};return(e=e||this._spec.data)&&(t.data=e),this._spec.transform&&(t.transform=this._spec.transform),t.mark=this._spec.mark,t.encoding=Pi.toEncoding(this.specQuery.encodings,{schema:this._schema,wildcardMode:"null"}),this._spec.width&&(t.width=this._spec.width),this._spec.height&&(t.height=this._spec.height),this._spec.background&&(t.background=this._spec.background),this._spec.padding&&(t.padding=this._spec.padding),this._spec.title&&(t.title=this._spec.title),null===t.encoding?null:((this._spec.config||this._opt.defaultSpecConfig)&&(t.config=zt.extend({},this._opt.defaultSpecConfig,this._spec.config)),t)}getRankingScore(e){return this._rankingScore[e]}setRankingScore(e,t){this._rankingScore[e]=t}}n.SpecQueryModel=s})),Wa=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0})})),Ya=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.normalize=void 0,t.normalize=function(e){if(e.groupBy){let t={groupBy:e.groupBy};e.orderBy&&(t.orderGroupBy=e.orderBy);let n={spec:zt.duplicate(e.spec),nest:[t]};return e.chooseBy&&(n.chooseBy=e.chooseBy),e.config&&(n.config=e.config),n}return zt.duplicate(e)}})),Ga=n((function(t,n){var r=e&&e.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.transform=n.spec=n.shorthand=n.groupBy=n.encoding=n.normalize=void 0;const a=o(Pi);n.encoding=a;const s=o(La);n.groupBy=s;const c=o(Ti);n.shorthand=c;const u=o(mi);n.spec=u;const l=o(Wa);n.transform=l,Object.defineProperty(n,"normalize",{enumerable:!0,get:function(){return Ya.normalize}})})),Qa=n((function(e,t){function n(e){return void 0!==e.items}Object.defineProperty(t,"__esModule",{value:!0}),t.mapLeaves=t.getTopResultTreeItem=t.isResultTree=void 0,t.isResultTree=n,t.getTopResultTreeItem=function(e){let t=e.items[0];for(;t&&n(t);)t=t.items[0];return t},t.mapLeaves=function e(t,r){return Object.assign(Object.assign({},t),{items:t.items.map((t=>n(t)?e(t,r):r(t)))})}})),$a=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Scorer=void 0;t.Scorer=class{constructor(e){this.type=e,this.scoreIndex=this.initScore()}getFeatureScore(e){const t=this.type,n=this.scoreIndex[e];if(void 0!==n)return{type:t,feature:e,score:n}}}})),Ha=n((function(t,n){var r=e&&e.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.getExtendedType=n.NONE=n.K=n.N=n.O=n.TIMEUNIT_O=n.TIMEUNIT_T=n.T=n.BIN_Q=n.Q=n.ExtendedType=void 0;const a=o(Dn);var s;!function(e){e[e.Q=a.QUANTITATIVE]="Q",e[e.BIN_Q="bin_"+a.QUANTITATIVE]="BIN_Q",e[e.T=a.TEMPORAL]="T",e[e.TIMEUNIT_T="timeUnit_time"]="TIMEUNIT_T",e[e.TIMEUNIT_O="timeUnit_"+a.ORDINAL]="TIMEUNIT_O",e[e.O=a.ORDINAL]="O",e[e.N=a.NOMINAL]="N",e[e.K=ci.ExpandedType.KEY]="K",e[e.NONE="-"]="NONE"}(s=n.ExtendedType||(n.ExtendedType={})),n.Q=s.Q,n.BIN_Q=s.BIN_Q,n.T=s.T,n.TIMEUNIT_T=s.TIMEUNIT_T,n.TIMEUNIT_O=s.TIMEUNIT_O,n.O=s.O,n.N=s.N,n.K=s.K,n.NONE=s.NONE,n.getExtendedType=function(e){if(e.bin)return s.BIN_Q;if(e.timeUnit){const t=Pi.scaleType(e);return Xt.hasDiscreteDomain(t)?s.TIMEUNIT_O:s.TIMEUNIT_T}return e.type}})),qa=n((function(t,n){var r=e&&e.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.AxisScorer=void 0;const a=o(Cn);class s extends $a.Scorer{constructor(){super("Axis")}initScore(e={}){e=Object.assign(Object.assign({},Rn.DEFAULT_QUERY_CONFIG),e);let t={};return[{feature:Ha.BIN_Q,opt:"preferredBinAxis"},{feature:Ha.T,opt:"preferredTemporalAxis"},{feature:Ha.TIMEUNIT_T,opt:"preferredTemporalAxis"},{feature:Ha.TIMEUNIT_O,opt:"preferredTemporalAxis"},{feature:Ha.O,opt:"preferredOrdinalAxis"},{feature:Ha.N,opt:"preferredNominalAxis"}].forEach((n=>{e[n.opt]===a.X?t[`${n.feature}_${a.Y}`]=-.01:e[n.opt]===a.Y&&(t[`${n.feature}_${a.X}`]=-.01)})),t}featurize(e,t){return`${e}_${t}`}getScore(e,t,n){return e.getEncodings().reduce(((e,t)=>{if(Pi.isFieldQuery(t)||Pi.isAutoCountQuery(t)){const n=Ha.getExtendedType(t),r=this.featurize(n,t.channel),i=this.getFeatureScore(r);i&&e.push(i)}return e}),[])}}n.AxisScorer=s})),za=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.DimensionScorer=void 0;class n extends $a.Scorer{constructor(){super("Dimension")}initScore(){return{row:-2,column:-2,color:0,opacity:0,size:0,shape:0}}getScore(e,t,n){return e.isAggregate()&&e.getEncodings().reduce(((e,t)=>{if(Pi.isAutoCountQuery(t)||Pi.isFieldQuery(t)&&!t.aggregate){const n=this.getFeatureScore(""+t.channel);if(n&&n.score>e.score)return n}return e}),{type:"Dimension",feature:"No Dimension",score:-5}),[]}}t.DimensionScorer=n})),Va=n((function(t,n){var r=e&&e.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.FacetScorer=void 0;const a=o(Cn);class s extends $a.Scorer{constructor(){super("Facet")}initScore(e){let t={};return(e=Object.assign(Object.assign({},Rn.DEFAULT_QUERY_CONFIG),e)).preferredFacet===a.ROW?t[a.COLUMN]=-.01:e.preferredFacet===a.COLUMN&&(t[a.ROW]=-.01),t}getScore(e,t,n){return e.getEncodings().reduce(((e,t)=>{if(Pi.isFieldQuery(t)||Pi.isAutoCountQuery(t)){const n=this.getFeatureScore(t.channel);n&&e.push(n)}return e}),[])}}n.FacetScorer=s})),Ka=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SizeChannelScorer=void 0;class n extends $a.Scorer{constructor(){super("SizeChannel")}initScore(){return{bar_size:-2,tick_size:-2}}getScore(e,t,n){const r=e.getMark();return e.getEncodings().reduce(((e,t)=>{if(Pi.isFieldQuery(t)||Pi.isAutoCountQuery(t)){const n=`${r}_${t.channel}`,i=this.getFeatureScore(n);i&&e.push(i)}return e}),[])}}t.SizeChannelScorer=n})),Xa=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.TypeChannelScorer=t.TERRIBLE=void 0,t.TERRIBLE=-10;class n extends $a.Scorer{constructor(){super("TypeChannel")}initScore(){let e={};const n={x:0,y:0,size:-.575,color:-.725,text:-2,opacity:-3,shape:t.TERRIBLE,row:t.TERRIBLE,column:t.TERRIBLE,detail:2*t.TERRIBLE};[Ha.Q,Ha.T,Ha.TIMEUNIT_T].forEach((t=>{zt.keys(n).forEach((r=>{e[this.featurize(t,r)]=n[r]}))}));const r=zt.extend({},n,{row:-.75,column:-.75,shape:-3.1,text:-3.2,detail:-4});[Ha.BIN_Q,Ha.TIMEUNIT_O,Ha.O].forEach((t=>{zt.keys(r).forEach((n=>{e[this.featurize(t,n)]=r[n]}))}));const i={x:0,y:0,color:-.6,shape:-.65,row:-.7,column:-.7,text:-.8,detail:-2,size:-3,opacity:-3.1};return zt.keys(i).forEach((t=>{e[this.featurize(Ha.N,t)]=i[t],e[this.featurize(Ha.K,t)]=zt.contains(["x","y","detail"],t)?-1:i[t]-2})),e}featurize(e,t){return`${e}_${t}`}getScore(e,t,n){const r=e.getEncodings().reduce(((e,t)=>{if(Pi.isFieldQuery(t)||Pi.isAutoCountQuery(t)){const n=Ti.fieldDef(t);(e[n]=e[n]||[]).push(t)}return e}),{}),i=[];return zt.forEach(r,(e=>{const t=e.reduce(((e,t)=>{if(Pi.isFieldQuery(t)||Pi.isAutoCountQuery(t)){const n=Ha.getExtendedType(t),r=this.featurize(n,t.channel),i=this.getFeatureScore(r);if(null===e||i.score>e.score)return i}return e}),null);i.push(t)})),i}}t.TypeChannelScorer=n})),Ja=n((function(t,n){var r=e&&e.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.featurize=n.MarkScorer=void 0;const a=o(Cn),s=o(In);class c extends $a.Scorer{constructor(){super("Mark")}initScore(){return function(){const e=[Ha.Q,Ha.T],t=[Ha.BIN_Q,Ha.TIMEUNIT_O,Ha.O,Ha.N,Ha.K].concat([Ha.NONE]);let n={};e.forEach((t=>{e.forEach((e=>{const r={point:0,text:-.2,tick:-.5,rect:-1,bar:-2,line:-2,area:-2,rule:-2.5};zt.forEach(r,((r,i)=>{const o=u(t,e,!0,i);n[o]=r}));const i={point:0,text:-.2,tick:-.5,bar:-2,line:-2,area:-2,rule:-2.5};zt.forEach(i,((r,i)=>{const o=u(t,e,!1,i);n[o]=r}))}))})),e.forEach((e=>{t.forEach((t=>{const r={tick:0,point:-.2,text:-.5,bar:-2,line:-2,area:-2,rule:-2.5};zt.forEach(r,((r,i)=>{const o=u(e,t,!0,i);n[o]=r;const a=u(t,e,!0,i);n[a]=r}))})),[Ha.TIMEUNIT_T].forEach((t=>{const r={point:0,text:-.5,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};zt.forEach(r,((r,i)=>{const o=u(e,t,!0,i);n[o]=r;const a=u(t,e,!0,i);n[a]=r}))})),[Ha.NONE,Ha.N,Ha.O,Ha.K].forEach((t=>{const r={bar:0,point:-.2,tick:-.25,text:-.3,line:-2,area:-2,rule:-2.5};zt.forEach(r,((r,i)=>{const o=u(e,t,!1,i);n[o]=r;const a=u(t,e,!1,i);n[a]=r}))})),[Ha.BIN_Q].forEach((t=>{const r={bar:0,point:-.2,tick:-.25,text:-.3,line:-.5,area:-.5,rule:-2.5};zt.forEach(r,((r,i)=>{const o=u(e,t,!1,i);n[o]=r;const a=u(t,e,!1,i);n[a]=r}))})),[Ha.TIMEUNIT_T,Ha.TIMEUNIT_O].forEach((t=>{const r={line:0,area:-.1,bar:-.2,point:-.3,tick:-.35,text:-.4,rule:-2.5};zt.forEach(r,((r,i)=>{const o=u(e,t,!1,i);n[o]=r;const a=u(t,e,!1,i);n[a]=r}))}))})),[Ha.TIMEUNIT_T].forEach((e=>{[Ha.TIMEUNIT_T].forEach((t=>{const r={point:0,rect:-.1,text:-.5,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};zt.forEach(r,((r,i)=>{const o=u(e,t,!0,i);n[o]=r})),zt.forEach(r,((r,i)=>{const o=u(e,t,!1,i);n[o]=r}))})),t.forEach((t=>{const r={tick:0,point:-.2,text:-.5,rect:-1,bar:-2,line:-2,area:-2,rule:-2.5};zt.forEach(r,((r,i)=>{const o=u(e,t,!0,i);n[o]=r})),zt.forEach(r,((r,i)=>{const o=u(t,e,!0,i);n[o]=r})),zt.forEach(r,((r,i)=>{const o=u(e,t,!1,i);n[o]=r})),zt.forEach(r,((r,i)=>{const o=u(t,e,!1,i);n[o]=r}))}))}));for(const e of t)for(const r of t){const t={point:0,rect:0,text:-.1,tick:-1,bar:-2,line:-2,area:-2,rule:-2.5};zt.forEach(t,((t,i)=>{const o=u(e,r,!0,i);n[o]=t})),zt.forEach(t,((t,i)=>{const o=u(e,r,!1,i);n[o]=t}))}return n}()}getScore(e,t,n){let r=e.getMark();r!==s.CIRCLE&&r!==s.SQUARE||(r=s.POINT);const i=e.getEncodingQueryByChannel(a.X),o=i?Ha.getExtendedType(i):Ha.NONE,c=e.getEncodingQueryByChannel(a.Y),u=`${o}_${c?Ha.getExtendedType(c):Ha.NONE}_${!e.isAggregate()}_${r}`,l=this.getFeatureScore(u);return l?[l]:(console.error("feature score missing for",u),[])}}function u(e,t,n,r){return`${e}_${t}_${n}_${r}`}n.MarkScorer=c,n.featurize=u})),Za=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.effectiveness=void 0;const n=[new qa.AxisScorer,new za.DimensionScorer,new Va.FacetScorer,new Ja.MarkScorer,new Ka.SizeChannelScorer,new Xa.TypeChannelScorer];t.effectiveness=function(e,t,r){const i=n.reduce(((n,i)=>{const o=i.getScore(e,t,r);return n.concat(o)}),[]);return{score:i.reduce(((e,t)=>e+t.score),0),features:i}}})),es=n((function(t,n){var r=e&&e.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.score=n.name=void 0;const a=o(Dn);n.name="aggregationQuality",n.score=function(e,t,r){const i=function(e,t,r){const i=e.getEncodings();if(e.isAggregate()){const e=e=>Pi.isFieldQuery(e)&&(e.type===a.QUANTITATIVE&&!e.bin&&!e.aggregate||e.type===a.TEMPORAL&&!e.timeUnit);if(zt.some(i,e))return{type:n.name,score:.1,feature:"Aggregate with raw continuous"};if(zt.some(i,(e=>Pi.isFieldQuery(e)&&Pi.isDimension(e)))){let e=zt.some(i,(e=>Pi.isFieldQuery(e)&&"count"===e.aggregate||Pi.isEnabledAutoCountQuery(e))),t=zt.some(i,(e=>Pi.isFieldQuery(e)&&!!e.bin));return e?{type:n.name,score:.8,feature:"Aggregate with count"}:t?{type:n.name,score:.7,feature:"Aggregate with bin but without count"}:{type:n.name,score:.9,feature:"Aggregate without count and without bin"}}return{type:n.name,score:.3,feature:"Aggregate without dimension"}}return zt.some(i,(e=>Pi.isFieldQuery(e)&&!Pi.isDimension(e)))?{type:n.name,score:1,feature:"Raw with measure"}:{type:n.name,score:.2,feature:"Raw without measure"}}(e);return{score:i.score,features:[i]}}})),ts=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.score=t.name=void 0,t.name="fieldOrder",t.score=function(e,t,n){const r=e.wildcardIndex.encodingIndicesByProperty.get("field");if(!r)return{score:0,features:[]};const i=e.specQuery.encodings,o=t.fieldSchemas.length,a=[];let s=0,c=1;for(let n=r.length-1;n>=0;n--){const u=r[n],l=i[u];let d;if(!Pi.isFieldQuery(l))continue;d=l.field;const f=e.wildcardIndex.encodings[u].get("field"),p=t.fieldSchema(d).index,g=-p*c;s+=g,a.push({score:g,type:"fieldOrder",feature:`field ${f.name} is ${d} (#${p} in the schema)`}),c*=o}return{score:s,features:a}}})),ns=n((function(t,n){var r=e&&e.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=e&&e.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)},a=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.EFFECTIVENESS=n.getScore=n.groupComparatorFactory=n.comparatorFactory=n.rank=n.get=n.register=n.fieldOrder=n.aggregation=void 0,o(Za,n);const s=a(es);n.aggregation=s;const c=a(ts);n.fieldOrder=c;let u={};function l(e,t){u[e]=t}function d(e){return u[e]}function f(e,t,n){return(r,i)=>g(e instanceof Array?e:[e],r,i,t,n)}function p(e,t,n){return(r,i)=>{const o=Qa.getTopResultTreeItem(r),a=Qa.getTopResultTreeItem(i);return g(e instanceof Array?e:[e],o,a,t,n)}}function g(e,t,n,r,i){for(let o of e){let e=y(n,o,r,i).score-y(t,o,r,i).score;if(0!==e)return e}return 0}function y(e,t,n,r){if(void 0!==e.getRankingScore(t))return e.getRankingScore(t);const i=d(t)(e,n,r);return e.setRankingScore(t,i),i}n.register=l,n.get=d,n.rank=function e(t,n,r,i){return n.nest&&i!==n.nest.length?(t.items.forEach((t=>{e(t,n,r,i+1)})),n.nest[i].orderGroupBy&&t.items.sort(p(n.nest[i].orderGroupBy,r,n.config))):(n.orderBy||n.chooseBy)&&(t.items.sort(f(n.orderBy||n.chooseBy,r,n.config)),n.chooseBy&&t.items.length>0&&t.items.splice(1)),t},n.comparatorFactory=f,n.groupComparatorFactory=p,n.getScore=y,n.EFFECTIVENESS="effectiveness",l(n.EFFECTIVENESS,Za.effectiveness),l(s.name,s.score),l(c.name,c.score)})),rs=n((function(t,n){var r=e&&e.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.xAxisOnTopForHighYCardinalityWithoutColumn=n.nominalColorScaleForHighCardinality=n.smallRangeStepForHighCardinalityOrFacet=n.stylize=void 0;const a=o(Cn),s=o(Dn);function c(e,t,n,r){[a.ROW,a.Y,a.COLUMN,a.X].forEach((t=>{n[t]=e.getEncodingQueryByChannel(t)}));const i=n[a.Y];if(void 0!==i&&Pi.isFieldQuery(i)&&(n[a.ROW]||t.cardinality(i)>r.smallRangeStepForHighCardinalityOrFacet.maxCardinality)){void 0===i.scale&&(i.scale={});const t=Pi.scaleType(i);i.scale&&(void 0===t||Xt.hasDiscreteDomain(t))&&(e.specQuery.height||(e.specQuery.height={step:12}))}const o=n[a.X];if(Pi.isFieldQuery(o)&&(n[a.COLUMN]||t.cardinality(o)>r.smallRangeStepForHighCardinalityOrFacet.maxCardinality)){void 0===o.scale&&(o.scale={});const t=Pi.scaleType(o);o.scale&&(void 0===t||Xt.hasDiscreteDomain(t))&&(e.specQuery.width||(e.specQuery.width={step:12}))}return e}function u(e,t,n,r){n[a.COLOR]=e.getEncodingQueryByChannel(a.COLOR);const i=n[a.COLOR];return Pi.isFieldQuery(i)&&void 0!==i&&(i.type===s.NOMINAL||i.type===ci.ExpandedType.KEY)&&t.cardinality(i)>r.nominalColorScaleForHighCardinality.maxCardinality&&(void 0===i.scale&&(i.scale={}),i.scale&&(i.scale.range||(i.scale.scheme=r.nominalColorScaleForHighCardinality.palette))),e}function l(e,t,n,r){if([a.COLUMN,a.X,a.Y].forEach((t=>{n[t]=e.getEncodingQueryByChannel(t)})),void 0===n[a.COLUMN]){const e=n[a.X],i=n[a.Y];Pi.isFieldQuery(e)&&Pi.isFieldQuery(i)&&void 0!==i&&i.field&&Xt.hasDiscreteDomain(Pi.scaleType(i))&&void 0!==e&&t.cardinality(i)>r.xAxisOnTopForHighYCardinalityWithoutColumn.maxCardinality&&(void 0===e.axis&&(e.axis={}),e.axis&&!e.axis.orient&&(e.axis.orient="top"))}return e}n.stylize=function(e,t,n){let r={};return e=e.map((function(e){return n.smallRangeStepForHighCardinalityOrFacet&&(e=c(e,t,r,n)),n.nominalColorScaleForHighCardinality&&(e=u(e,t,r,n)),n.xAxisOnTopForHighYCardinalityWithoutColumn&&(e=l(e,t,r,n)),e}))},n.smallRangeStepForHighCardinalityOrFacet=c,n.nominalColorScaleForHighCardinality=u,n.xAxisOnTopForHighYCardinalityWithoutColumn=l})),is=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.generate=void 0,t.generate=function(e,t,n=Rn.DEFAULT_QUERY_CONFIG){const r=Ba.SpecQueryModel.build(e,t,n),i=r.wildcardIndex;let o=[r];return n.propertyPrecedence.forEach((e=>{const r=Jt.fromKey(e);if(i.hasProperty(r)){const e=xa.getEnumerator(r)(i,t,n);o=o.reduce(e,[])}})),!n.stylize||null===n.nominalColorScaleForHighCardinality&&null===n.smallRangeStepForHighCardinalityOrFacet&&null===n.xAxisOnTopForHighYCardinalityWithoutColumn?o:rs.stylize(o,t,n)}})),os=n((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.recommend=void 0,t.recommend=function(e,t,n){e=Object.assign(Object.assign({},Ya.normalize(e)),{config:Object.assign(Object.assign(Object.assign({},Rn.DEFAULT_QUERY_CONFIG),n),e.config)});const r=is.generate(e.spec,t,e.config),i=ka.nest(r,e.nest);return{query:e,result:ns.rank(i,e,t,0)}}})),as="0.21.2";return t(n((function(t,n){var r=e&&e.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return i(t,e),t};Object.defineProperty(n,"__esModule",{value:!0}),n.util=n.schema=n.result=n.ranking=n.query=n.property=n.nest=n.model=n.wildcard=n.enumerate=n.constraint=n.config=n.version=n.recommend=n.generate=void 0;const a=o(Rn);n.config=a;const s=o(Fa);n.constraint=s;const c=o(xa);n.enumerate=c;const u=o(Mn);n.wildcard=u;const l=o(Ba);n.model=l;const d=o(ka);n.nest=d;const f=o(Jt);n.property=f;const p=o(Ga);n.query=p;const g=o(ns);n.ranking=g;const y=o(Qa);n.result=y;const h=o(Ia);n.schema=h;const m=o(zt);n.util=m,Object.defineProperty(n,"generate",{enumerable:!0,get:function(){return is.generate}}),Object.defineProperty(n,"recommend",{enumerable:!0,get:function(){return os.recommend}}),Object.defineProperty(n,"version",{enumerable:!0,get:function(){return as}})})))}));